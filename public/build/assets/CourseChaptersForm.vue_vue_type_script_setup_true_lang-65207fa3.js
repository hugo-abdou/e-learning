import{_ as J,a as K}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-f2d763a2.js";import{_ as Q}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-1bc17a1b.js";import{_ as X}from"./ActionButton-893daa0c.js";import{d as Y,r as V,cc as Z,a8 as ee,I as ae,o as v,c as F,b as a,f as l,q as n,b2 as le,A as te,F as U,j as oe,e as h,y as x,z as _,al as P,h as g,bW as se,bb as ne,v as B,bd as y,bf as re,bH as D,bI as E,c2 as ie,k as de,a3 as ue,cd as pe}from"./main-2d2efdef.js";import{r as w}from"./validators-753247d6.js";import{_ as me}from"./index-c8be389a.js";import{u as ce}from"./useCourseStore-6cd84d06.js";import{U as fe,s as ve}from"./utils-cf604421.js";import{V as be,a as Ve,b as he,c as _e}from"./VExpansionPanel-8b4637e4.js";import{V as ge}from"./VForm-d1b03105.js";import{V as ye}from"./VSpacer-f886726f.js";import{V as we}from"./VMenu-1ed28082.js";import{V as ke}from"./VList-3e9a4151.js";import{V as k,a as m}from"./VRow-b362c44e.js";import{V as C}from"./VTextField-a58b9262.js";import{V as Ce}from"./VSelect-4c5979a9.js";import{V as $e}from"./VSwitch-c025f875.js";import{b as Te}from"./VInput-84038333.js";const Fe={class:"text-truncate"},Ue={class:"d-flex flex-column align-center"},xe={class:"text-center"},Ke=Y({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"grid"}},setup(N,{expose:z}){const O=N,S=ce(),c=V(0),t=V(O.chapters),b=V({}),u=Z({open:!1,type:""}),$=ee(()=>{var e;return((e=t.value[c.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}});ae(()=>{t.value.length===0&&t.value.push({title:"",attachments:[],order:0,id:0})});const M=()=>{u.open=!1,u.type=null},A=e=>{u.open=!0,u.type=e},I=e=>{console.log(e),u.type==="upload-chapter-attachment"&&t.value[c.value].attachments.push(...e.map(o=>({...o,visibility:[],download:!1,watermark:""}))),M()},R=async e=>{const o=t.value[e];o.id&&await S.deleteChapter(o.id),t.value=t.value.filter((i,p)=>p!==e)},T=()=>new Promise(async(e,o)=>{for(let i=0;i<t.value.length;i++){c.value=i,await pe(100);const{valid:p}=await b.value.validate();if(!p)return ve(),o(new Error("validation faild"))}e("Ok")}),L=async()=>{try{await T(),t.value.push({title:"",attachments:[],order:t.value.length,id:0}),c.value++}catch{}},q=e=>{const o=[...t.value];o[e]=t.value[e-1],o[e-1]=t.value[e],t.value=o},j=e=>{const o=[...t.value];o[e]=t.value[e+1],o[e+1]=t.value[e],t.value=o};return z({formEl:b,validate:async()=>{try{return await T(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,o)=>{const i=X,p=Q,H=K,W=J;return v(),F(U,null,[a(n(ge),{ref_key:"formEl",ref:b},{default:l(()=>[a(be,{modelValue:n(c),"onUpdate:modelValue":o[1]||(o[1]=r=>le(c)?c.value=r:null),class:te(n(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(v(!0),F(U,null,oe(n(t),(r,f)=>(v(),g(Ve,{key:f},{default:l(()=>[a(he,null,se({default:l(()=>[a(ne,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[h("span",Fe,_(r.title||`Chapter ${f+1}`),1),a(ye)]),_:2},1024)]),_:2},[n(t).length>1?{name:"actions",fn:l(()=>[a(we,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:s})=>[a(i,B({variant:"plain",color:"default"},s,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(ke,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(i,{variant:"text",disabled:f===0,icon:"mdi-arrow-up",onClick:y(s=>q(f),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",disabled:f+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:y(s=>j(f),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",icon:"tabler-trash",color:"error",onClick:y(s=>R(f),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(_e,{class:"border-t"},{default:l(()=>[a(re,{class:"mb-5"},{default:l(()=>[a(k,null,{default:l(()=>[a(m,{cols:"12",class:"mb-3"},{default:l(()=>[a(C,{modelValue:r.title,"onUpdate:modelValue":s=>r.title=s,rules:[n(w)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(H,{class:"w-100",items:r.attachments,grid:e.gridType==="grid"?{cols:"12",sm:"6"}:{cols:"12"}},{default:l(({item:s})=>[(v(),g(k,{key:e.gridType,class:"rounded-lg bg-background border w-100 ma-0"},{default:l(()=>[a(m,D(E(e.gridType==="list"?{cols:"12",md:"4"}:{cols:"12"})),{default:l(()=>[a(me,{media:s,deletable:"","is-preview":"","aspect-ratio":"2",onOnDelete:d=>r.attachments=r.attachments.filter(({id:G})=>G!==s.id)},null,8,["media","onOnDelete"])]),_:2},1040),a(m,D(E(e.gridType==="list"?{cols:"12",md:"8"}:{cols:"12"})),{default:l(()=>[a(k,null,{default:l(()=>[a(m,{cols:"12"},{default:l(()=>[a(C,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,rules:[n(w)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(m,{cols:"12",md:"6"},{default:l(()=>[a(Ce,{modelValue:s.visibility,"onUpdate:modelValue":d=>s.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[n(w)],chips:"",multiple:""},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(m,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:l(()=>[a($e,{modelValue:s.download,"onUpdate:modelValue":d=>s.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(p,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),s.type===n(ie).pdf?(v(),g(m,{key:0,cols:"12"},{default:l(()=>[a(C,{modelValue:s.watermark,"onUpdate:modelValue":d=>s.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):de("",!0)]),_:2},1024)]),_:2},1040)]),_:2},1024))]),_:2},1032,["items","grid"]),a(m,{cols:"12"},{default:l(()=>[a(p,{text:e.$t("media.upload.description")},{default:l(({props:s})=>[a(P,B({...s,...n(fe)},{style:{"block-size":"100%"},onClick:o[0]||(o[0]=d=>A("upload-chapter-attachment"))}),{default:l(()=>[h("div",Ue,[a(ue,{icon:"fluent:document-add-16-regular",size:"32"}),a(Te,{class:"mt-2"},{default:l(()=>[x(_(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1},8,["text"])]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),h("div",xe,[a(P,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:L},{default:l(()=>[x(_(e.$t("Add Chapter")),1)]),_:1})]),a(W,{"is-dialog-visible":n(u).open,"onUpdate:isDialogVisible":o[2]||(o[2]=r=>n(u).open=r),"allowed-file-types":n($).allowedFileTypes,"max-number-of-files":n($).maxNumberOfFiles,onDone:I},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{Ke as _};
