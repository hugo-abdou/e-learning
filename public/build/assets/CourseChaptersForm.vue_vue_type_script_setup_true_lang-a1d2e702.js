import{_ as K,a as W}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-61f4e6ed.js";import{_ as X}from"./AppSelect.vue_vue_type_script_setup_true_lang-a346bd8f.js";import{_ as Y}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-0241b29a.js";import{_ as Z}from"./ActionButton-88e06515.js";import{t as ee,r as V,c3 as ae,aA as le,k as te,v as b,x as U,n as a,A as l,H as i,L as oe,ab as se,F,y as ie,D as f,aa as T,E as _,B as P,z as S,bV as ne,s as D,bj as w,a2 as re,C as de,c4 as ue}from"./plugins-900eb03f.js";import{r as y}from"./validators-229769c7.js";import{M as me}from"./index-cecf332b.js";import{u as pe}from"./useCourseStore-eea862c2.js";import{U as ce,s as fe}from"./utils-01d7f181.js";import{u as ve}from"./useQuizzesStore-90e757e2.js";import{V as Ve,a as be,b as he,c as _e}from"./VExpansionPanel-2b5697f4.js";import{V as we}from"./VForm-4f08ce3e.js";import{b as ye,V as ge}from"./VCard-6d8b9f87.js";import{V as Ce}from"./VSpacer-35711271.js";import{V as ke}from"./VMenu-479530dd.js";import{V as xe}from"./VList-ff1b2c79.js";import{V as v}from"./VCardText-65c366cb.js";import{V as ze,a as g}from"./VRow-bc79db32.js";import{V as C}from"./VTextField-e9152184.js";import{V as $e}from"./VDivider-bf01317e.js";import{V as Ue}from"./VSelect-bce5aa79.js";import{V as Fe}from"./VSwitch-3d7c56ad.js";import{b as B}from"./VInput-d19eb2fc.js";const Te={class:"text-truncate"},Pe={class:"d-flex justify-space-between align-center flex-wrap flex-md-nowrap flex-column flex-md-row"},Se={class:"v-col-md-4 pa-0 pa-md-2 h-100"},De={class:"v-col-md-8"},Be={class:"d-flex flex-column align-center"},Ee={class:"text-center"},ia=ee({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"list"}},setup(E,{expose:A}){const k=E,N=pe(),p=V(0),t=V(k.chapters),x=V([]),h=V({}),u=ae({open:!1,type:""}),z=le(()=>{var e;return((e=t.value[p.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}}),q=ve();te(()=>{console.log(k.chapters),t.value.length===0&&t.value.push({title:"",attachments:[],quizzes:[],order:0,id:0}),q.getQuizzes({params:{itemsPerPage:1e3}}).then(({data:e})=>x.value=e)});const M=()=>{u.open=!1,u.type=null},O=e=>{u.open=!0,u.type=e},L=e=>{u.type==="upload-chapter-attachment"&&t.value[p.value].attachments.push(...e.map((s,r)=>({...s,visibility:[],download:!1,watermark:""}))),M()},Q=async e=>{const s=t.value[e];s.id&&await N.deleteChapter(s.id),t.value=t.value.filter((r,m)=>m!==e)},$=()=>new Promise(async(e,s)=>{for(let r=0;r<t.value.length;r++){p.value=r,await ue(100);const{valid:m}=await h.value.validate();if(!m)return fe(),s(new Error("validation faild"))}e("Ok")}),j=async()=>{try{await $(),t.value.push({title:"",attachments:[],quizzes:[],order:t.value.length,id:0}),p.value++}catch{}},R=e=>{const s=[...t.value];s[e]=t.value[e-1],s[e-1]=t.value[e],t.value=s},I=e=>{const s=[...t.value];s[e]=t.value[e+1],s[e+1]=t.value[e],t.value=s};return A({formEl:h,validate:async()=>{try{return await $(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,s)=>{const r=Z,m=Y,H=W,G=X,J=K;return b(),U(F,null,[a(i(we),{ref_key:"formEl",ref:h},{default:l(()=>[a(Ve,{modelValue:i(p),"onUpdate:modelValue":s[1]||(s[1]=n=>oe(p)?p.value=n:null),class:se(i(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(b(!0),U(F,null,ie(i(t),(n,c)=>(b(),S(be,{key:c},{default:l(()=>[a(he,null,ne({default:l(()=>[a(ye,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[f("span",Te,_(n.title||`Chapter ${c+1}`),1),a(Ce)]),_:2},1024)]),_:2},[i(t).length>1?{name:"actions",fn:l(()=>[a(ke,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:o})=>[a(r,D({variant:"plain",color:"default"},o,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(xe,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(r,{variant:"text",disabled:c===0,icon:"mdi-arrow-up",onClick:w(o=>R(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",disabled:c+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:w(o=>I(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",icon:"tabler-trash",color:"error",onClick:w(o=>Q(c),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(_e,{class:"border-t"},{default:l(()=>[a(v,{class:"mb-5"},{default:l(()=>[a(ze,null,{default:l(()=>[a(g,{cols:"12",class:"mb-2"},{default:l(()=>[a(C,{modelValue:n.title,"onUpdate:modelValue":o=>n.title=o,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(H,{class:"w-100",items:n.attachments,grid:{cols:"12"}},{default:l(({item:o})=>[a(ge,{class:"bg-background"},{default:l(()=>[f("div",Pe,[f("div",Se,[a(i(me),{media:o,preview:"",deletable:"",onDelete:()=>{n.attachments=n.attachments.filter(({id:d})=>d!==o.id)}},null,8,["media","onDelete"])]),a($e,{vertical:e.$vuetify.display.mdAndUp},null,8,["vertical"]),f("div",De,[a(v,null,{default:l(()=>[a(C,{modelValue:o.name,"onUpdate:modelValue":d=>o.name=d,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(v,null,{default:l(()=>[a(Ue,{modelValue:o.visibility,"onUpdate:modelValue":d=>o.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[i(y)],chips:"",multiple:""},{"append-inner":l(()=>[a(m,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(v,{class:"d-flex justify-space-between"},{default:l(()=>[a(Fe,{modelValue:o.download,"onUpdate:modelValue":d=>o.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(m,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),o.type==="pdf"?(b(),S(v,{key:0},{default:l(()=>[a(C,{modelValue:o.watermark,"onUpdate:modelValue":d=>o.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(m,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):re("",!0)])])]),_:2},1024)]),_:2},1032,["items"]),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(B,{text:e.$t("chapter.fields.attachments.label")},null,8,["text"]),a(m,{text:"upload the course materials that you prepare for this chapter"},{default:l(({props:o})=>[a(P,D({...o,...i(ce)},{style:{"block-size":"100%"},onClick:s[0]||(s[0]=d=>O("upload-chapter-attachment"))}),{default:l(()=>[f("div",Be,[a(de,{icon:"fluent:document-add-16-regular",size:"32"}),a(B,{class:"mt-2"},{default:l(()=>[T(_(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1})]),_:1}),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(G,{modelValue:n.quizzes,"onUpdate:modelValue":o=>n.quizzes=o,items:i(x),label:"Quizzes","item-value":"id",placeholder:"Select Quizzes",chips:"",multiple:"","closable-chips":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),f("div",Ee,[a(P,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:j},{default:l(()=>[T(_(e.$t("Add Chapter")),1)]),_:1})]),a(J,{"is-dialog-visible":i(u).open,"onUpdate:isDialogVisible":s[2]||(s[2]=n=>i(u).open=n),"allowed-file-types":i(z).allowedFileTypes,"max-number-of-files":i(z).maxNumberOfFiles,onDone:L},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{ia as _};
