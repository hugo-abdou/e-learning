import{_ as J,a as K}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-6bdbe54a.js";import{_ as W}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-5233097e.js";import{_ as X}from"./ActionButton-e7de0636.js";import{d as Y,r as V,b$ as Z,a6 as ee,G as ae,o as v,c as x,b as a,f as l,p as r,e as h,aj as F,F as U,b0 as le,y as te,j as oe,v as P,x as g,c0 as se,h as y,bA as re,ba as ne,s as B,bc as _,bm as ie,bB as D,bC as E,bQ as de,z as ue,a0 as pe}from"./main-6e33e0f4.js";import{r as w}from"./validators-f52bbb1d.js";import{M as me}from"./index-0c36f9df.js";import{u as ce}from"./useCourseStore-b6ef2792.js";import{s as fe,U as ve}from"./utils-fc59a690.js";import{V as be}from"./VForm-cfccf0e4.js";import{V as Ve,a as he,b as ge,c as ye}from"./VExpansionPanel-92f8bef3.js";import{V as _e}from"./VSpacer-7809d458.js";import{V as we}from"./VMenu-02d70115.js";import{V as Ce}from"./VList-1acb65c4.js";import{V as C,a as m}from"./VRow-26e77137.js";import{V as k}from"./VTextField-c1b9a4f9.js";import{V as ke}from"./VSelect-8dae4b5d.js";import{V as $e}from"./VSwitch-2788838f.js";import{b as Te}from"./VInput-0a556944.js";const xe={class:"text-truncate"},Fe={class:"d-flex flex-column align-center"},Ue={class:"text-center"},Ke=Y({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"grid"}},setup(M,{expose:N}){const z=M,O=ce(),c=V(0),t=V(z.chapters),b=V({}),u=Z({open:!1,type:""}),$=ee(()=>{var e;return((e=t.value[c.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}});ae(()=>{t.value.length===0&&t.value.push({title:"",attachments:[],order:0,id:0})});const S=()=>{u.open=!1,u.type=null},A=e=>{u.open=!0,u.type=e},R=e=>{console.log(e),u.type==="upload-chapter-attachment"&&t.value[c.value].attachments.push(...e.map(o=>({...o,visibility:[],download:!1,watermark:""}))),S()},L=async e=>{const o=t.value[e];o.id&&await O.deleteChapter(o.id),t.value=t.value.filter((i,p)=>p!==e)},T=()=>new Promise(async(e,o)=>{for(let i=0;i<t.value.length;i++){c.value=i,await se(100);const{valid:p}=await b.value.validate();if(!p)return fe(),o(new Error("validation faild"))}e("Ok")}),j=async()=>{try{await T(),t.value.push({title:"",attachments:[],order:t.value.length,id:0}),c.value++}catch{}},I=e=>{const o=[...t.value];o[e]=t.value[e-1],o[e-1]=t.value[e],t.value=o},q=e=>{const o=[...t.value];o[e]=t.value[e+1],o[e+1]=t.value[e],t.value=o};return N({formEl:b,validate:async()=>{try{return await T(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,o)=>{const i=X,p=W,G=K,Q=J;return v(),x(U,null,[a(r(be),{ref_key:"formEl",ref:b},{default:l(()=>[a(Ve,{modelValue:r(c),"onUpdate:modelValue":o[1]||(o[1]=n=>le(c)?c.value=n:null),class:te(r(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(v(!0),x(U,null,oe(r(t),(n,f)=>(v(),y(he,{key:f},{default:l(()=>[a(ge,null,re({default:l(()=>[a(ne,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[h("span",xe,g(n.title||`Chapter ${f+1}`),1),a(_e)]),_:2},1024)]),_:2},[r(t).length>1?{name:"actions",fn:l(()=>[a(we,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:s})=>[a(i,B({variant:"plain",color:"default"},s,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(Ce,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(i,{variant:"text",disabled:f===0,icon:"mdi-arrow-up",onClick:_(s=>I(f),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",disabled:f+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:_(s=>q(f),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",icon:"tabler-trash",color:"error",onClick:_(s=>L(f),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(ye,{class:"border-t"},{default:l(()=>[a(ie,{class:"mb-5"},{default:l(()=>[a(C,null,{default:l(()=>[a(m,{cols:"12",class:"mb-3"},{default:l(()=>[a(k,{modelValue:n.title,"onUpdate:modelValue":s=>n.title=s,rules:[r(w)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(G,{class:"w-100",items:n.attachments,grid:e.gridType==="grid"?{cols:"12",sm:"6"}:{cols:"12"}},{default:l(({item:s})=>[(v(),y(C,{key:e.gridType,class:"rounded-lg bg-background border w-100 ma-0"},{default:l(()=>[a(m,D(E(e.gridType==="list"?{cols:"12",md:"4"}:{cols:"12"})),{default:l(()=>[a(me,{media:s,deletable:"","is-preview":"","aspect-ratio":"2",onOnDelete:d=>n.attachments=n.attachments.filter(({id:H})=>H!==s.id)},null,8,["media","onOnDelete"])]),_:2},1040),a(m,D(E(e.gridType==="list"?{cols:"12",md:"8"}:{cols:"12"})),{default:l(()=>[a(C,null,{default:l(()=>[a(m,{cols:"12"},{default:l(()=>[a(k,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,rules:[r(w)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(m,{cols:"12",md:"6"},{default:l(()=>[a(ke,{modelValue:s.visibility,"onUpdate:modelValue":d=>s.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[r(w)],chips:"",multiple:""},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(m,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:l(()=>[a($e,{modelValue:s.download,"onUpdate:modelValue":d=>s.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(p,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),s.type===r(de).pdf?(v(),y(m,{key:0,cols:"12"},{default:l(()=>[a(k,{modelValue:s.watermark,"onUpdate:modelValue":d=>s.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):ue("",!0)]),_:2},1024)]),_:2},1040)]),_:2},1024))]),_:2},1032,["items","grid"]),a(m,{cols:"12"},{default:l(()=>[a(p,{text:e.$t("media.upload.description")},{default:l(({props:s})=>[a(F,B({...s,...r(ve)},{style:{"block-size":"100%"},onClick:o[0]||(o[0]=d=>A("upload-chapter-attachment"))}),{default:l(()=>[h("div",Fe,[a(pe,{icon:"fluent:document-add-16-regular",size:"32"}),a(Te,{class:"mt-2"},{default:l(()=>[P(g(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1},8,["text"])]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),h("div",Ue,[a(F,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:j},{default:l(()=>[P(g(e.$t("Add Chapter")),1)]),_:1})]),a(Q,{"is-dialog-visible":r(u).open,"onUpdate:isDialogVisible":o[2]||(o[2]=n=>r(u).open=n),"allowed-file-types":r($).allowedFileTypes,"max-number-of-files":r($).maxNumberOfFiles,onDone:R},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{Ke as _};
