import{_ as K,a as W}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-76076707.js";import{_ as X}from"./AppSelect.vue_vue_type_script_setup_true_lang-ed142275.js";import{_ as Y}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-d423ce93.js";import{_ as Z}from"./ActionButton-0cde9d24.js";import{t as ee,r as V,c3 as ae,aA as le,k as te,v as b,x as $,n as a,A as l,H as i,L as oe,ab as se,F as U,y as ie,D as f,aa as F,E as _,B as T,z as P,bV as ne,s as S,bj as w,a2 as re,C as de,c4 as ue}from"./plugins-1ca62e54.js";import{r as y}from"./validators-3a378363.js";import{M as me}from"./index-b32b8b4e.js";import{u as pe}from"./useCourseStore-b2aa19e2.js";import{U as ce,s as fe}from"./utils-4f96d8b5.js";import{s as ve}from"./slugify-624934a4.js";import{u as Ve}from"./useQuizzesStore-6ffdf938.js";import{V as be,a as he,b as _e,c as we}from"./VExpansionPanel-60a279c2.js";import{V as ye}from"./VForm-11822a25.js";import{b as ge,V as Ce}from"./VCard-2a55749d.js";import{V as ke}from"./VSpacer-b2217678.js";import{V as xe}from"./VMenu-3b09bac4.js";import{V as ze}from"./VList-32d892a6.js";import{V as v}from"./VCardText-f87185bc.js";import{V as $e,a as g}from"./VRow-063e83bb.js";import{V as C}from"./VTextField-38237e59.js";import{V as Ue}from"./VDivider-e9bd568d.js";import{V as Fe}from"./VSelect-4231bef2.js";import{V as Te}from"./VSwitch-15c3cd26.js";import{b as D}from"./VInput-0f0d564d.js";const Pe={class:"text-truncate"},Se={class:"d-flex justify-space-between align-center flex-wrap flex-md-nowrap flex-column flex-md-row"},De={class:"v-col-md-4 pa-0 pa-md-2 h-100"},Be={class:"v-col-md-8"},Ee={class:"d-flex flex-column align-center"},Ae={class:"text-center"},ra=ee({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"list"}},setup(B,{expose:E}){const A=B,N=pe(),p=V(0),t=V(A.chapters),k=V([]),h=V({}),u=ae({open:!1,type:""}),x=le(()=>{var e;return((e=t.value[p.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}}),q=Ve();te(()=>{t.value.length===0&&t.value.push({title:"",attachments:[],quizzes:[],order:0,id:0}),q.getQuizzes({params:{itemsPerPage:1e3}}).then(({data:e})=>k.value=e)});const M=()=>{u.open=!1,u.type=null},O=e=>{u.open=!0,u.type=e},L=e=>{u.type==="upload-chapter-attachment"&&t.value[p.value].attachments.push(...e.map((o,r)=>({...o,visibility:[],download:!1,watermark:"",slug:ve(o.name)}))),M()},Q=async e=>{const o=t.value[e];o.id&&await N.deleteChapter(o.id),t.value=t.value.filter((r,m)=>m!==e)},z=()=>new Promise(async(e,o)=>{for(let r=0;r<t.value.length;r++){p.value=r,await ue(100);const{valid:m}=await h.value.validate();if(!m)return fe(),o(new Error("validation faild"))}e("Ok")}),j=async()=>{try{await z(),t.value.push({title:"",attachments:[],quizzes:[],order:t.value.length,id:0}),p.value++}catch{}},R=e=>{const o=[...t.value];o[e]=t.value[e-1],o[e-1]=t.value[e],t.value=o},I=e=>{const o=[...t.value];o[e]=t.value[e+1],o[e+1]=t.value[e],t.value=o};return E({formEl:h,validate:async()=>{try{return await z(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,o)=>{const r=Z,m=Y,H=W,G=X,J=K;return b(),$(U,null,[a(i(ye),{ref_key:"formEl",ref:h},{default:l(()=>[a(be,{modelValue:i(p),"onUpdate:modelValue":o[1]||(o[1]=n=>oe(p)?p.value=n:null),class:se(i(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(b(!0),$(U,null,ie(i(t),(n,c)=>(b(),P(he,{key:c},{default:l(()=>[a(_e,null,ne({default:l(()=>[a(ge,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[f("span",Pe,_(n.title||`Chapter ${c+1}`),1),a(ke)]),_:2},1024)]),_:2},[i(t).length>1?{name:"actions",fn:l(()=>[a(xe,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:s})=>[a(r,S({variant:"plain",color:"default"},s,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(ze,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(r,{variant:"text",disabled:c===0,icon:"mdi-arrow-up",onClick:w(s=>R(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",disabled:c+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:w(s=>I(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",icon:"tabler-trash",color:"error",onClick:w(s=>Q(c),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(we,{class:"border-t"},{default:l(()=>[a(v,{class:"mb-5"},{default:l(()=>[a($e,null,{default:l(()=>[a(g,{cols:"12",class:"mb-2"},{default:l(()=>[a(C,{modelValue:n.title,"onUpdate:modelValue":s=>n.title=s,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(H,{class:"w-100",items:n.attachments,grid:{cols:"12"}},{default:l(({item:s})=>[a(Ce,{class:"bg-background"},{default:l(()=>[f("div",Se,[f("div",De,[a(i(me),{media:s,preview:"",deletable:"",onDelete:()=>{n.attachments=n.attachments.filter(({id:d})=>d!==s.id)}},null,8,["media","onDelete"])]),a(Ue,{vertical:e.$vuetify.display.mdAndUp},null,8,["vertical"]),f("div",Be,[a(v,null,{default:l(()=>[a(C,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(v,null,{default:l(()=>[a(Fe,{modelValue:s.visibility,"onUpdate:modelValue":d=>s.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[i(y)],chips:"",multiple:""},{"append-inner":l(()=>[a(m,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(v,{class:"d-flex justify-space-between"},{default:l(()=>[a(Te,{modelValue:s.download,"onUpdate:modelValue":d=>s.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(m,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),s.type==="pdf"?(b(),P(v,{key:0},{default:l(()=>[a(C,{modelValue:s.watermark,"onUpdate:modelValue":d=>s.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(m,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):re("",!0)])])]),_:2},1024)]),_:2},1032,["items"]),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(D,{text:e.$t("chapter.fields.attachments.label")},null,8,["text"]),a(m,{text:"upload the course materials that you prepare for this chapter"},{default:l(({props:s})=>[a(T,S({...s,...i(ce)},{style:{"block-size":"100%"},onClick:o[0]||(o[0]=d=>O("upload-chapter-attachment"))}),{default:l(()=>[f("div",Ee,[a(de,{icon:"fluent:document-add-16-regular",size:"32"}),a(D,{class:"mt-2"},{default:l(()=>[F(_(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1})]),_:1}),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(G,{modelValue:n.quizzes,"onUpdate:modelValue":s=>n.quizzes=s,items:i(k),label:"Quizzes","item-value":"id",placeholder:"Select Quizzes",chips:"",multiple:"","closable-chips":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),f("div",Ae,[a(T,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:j},{default:l(()=>[F(_(e.$t("Add Chapter")),1)]),_:1})]),a(J,{"is-dialog-visible":i(u).open,"onUpdate:isDialogVisible":o[2]||(o[2]=n=>i(u).open=n),"allowed-file-types":i(x).allowedFileTypes,"max-number-of-files":i(x).maxNumberOfFiles,onDone:L},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{ra as _};
