import{r as $}from"./validators-4b12fd35.js";import{_ as be}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-73b71da1.js";import{_ as he}from"./DateTimePicker.vue_vue_type_style_index_0_lang-f35c6110.js";import{_ as ye}from"./CustomRadiosWithIcon-908fec3a.js";import{_ as we}from"./CollapsedContent.vue_vue_type_script_setup_true_lang-1b4ecc6e.js";import{_ as ke}from"./EditorJs.vue_vue_type_style_index_0_lang-81c764b7.js";import{_ as qe}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-7165c29f.js";import{_ as Ce}from"./AppStepper.vue_vue_type_style_index_0_lang-a7e7938d.js";import{d as ge,r as _,e$ as h,m as $e,a as Y,o as d,c as z,e as S,b as e,q as i,f as t,b4 as U,bb as ee,bh as te,F as P,j as M,k as x,am as y,v as O,cj as ze,a4 as q,y as r,z as L,bG as le,V as Se,h as C,bc as Ue,bg as Pe}from"./main-83f81ad7.js";import{u as De}from"./useQuizzesStore-03bccf3d.js";import{a as Qe,b as A}from"./VWindowItem-deb37c17.js";import{V as N,a as c}from"./VRow-4a6d7b26.js";import{V as E}from"./VTextField-d890cb14.js";import{V as Te}from"./VTextarea-6556f843.js";import{b as Oe}from"./VInput-c65df7da.js";import{V as W}from"./VTooltip-29248371.js";import{V as Ae,a as ae,b as oe,c as se}from"./VExpansionPanel-3f03541e.js";import{V as Ne}from"./VForm-ee00a18c.js";import{V as Ee}from"./VCheckbox-0bad0c9a.js";import{V as Be}from"./VSwitch-b5fa853e.js";import"./VCheckboxBtn-29b3e515.js";import"./VSelectionControl-a9b789af.js";import"./AppTextField.vue_vue_type_script_setup_true_lang-7e68b421.js";import"./lodash-c2667fb2.js";import"./preact.module-7f17e2b0.js";import"./component-769f8347.js";import"./VField-d76a4324.js";import"./VRadioGroup-26daf95b.js";import"./VSlideGroup-14ea7fb7.js";import"./VSlideGroupItem-3141f46e.js";import"./ssrBoot-7be77cee.js";const je={class:"mb-6"},Fe={class:"d-flex flex-column align-center"},Ie={class:"d-flex align-start gap-2"},Re={class:"ml-4",style:{width:"40px"}},Je={class:"d-flex flex-wrap gap-4 justify-sm-space-between justify-center mt-8"},kt=ge({__name:"create",setup(Me){const G=[{title:"Details",icon:"tabler-list-details"},{title:"Attachments",icon:"tabler-paperclip"},{title:"Questions",icon:"tabler-device-ipad-question"},{title:"Visibility",icon:"tabler-eye"}],m=_(0),B=_({}),Z=async()=>{const{valid:l,errors:o}=await B.value.validate();return l?Promise.resolve():Promise.reject(o)},ie=()=>{Z().then(()=>m.value++)},H={title:"",description:"",duration:5,status:"Draft",attachments:[],questions:[{id:h(),allow_custom_answer:!1,question:{},options:[{id:h(),option:"",points:0,is_correct:!1}]}]},s=_({...H}),g=_(!1),ne=l=>{s.value.attachments.splice(l,1)},re=l=>{s.value.questions.push({...s.value.questions[l],id:h(),options:s.value.questions[l].options.map(o=>({...o,id:h()}))})},ue=l=>{s.value.questions.splice(l,1)},K=()=>{s.value.questions.push({id:h(),allow_custom_answer:!1,question:{},options:[{id:h(),option:"",points:0,is_correct:!1}]})},de=(l,o)=>{s.value.questions[l].options.splice(o,1)},ce=l=>{s.value.questions[l].options.push({id:h(),option:"",points:0,is_correct:!1})},v=_("publish"),D=_("Private"),me=[{title:"Private",desc:"Only you see can this quiz",value:"Private",icon:{icon:"carbon:virtual-private-cloud",size:"28"}},{title:"Publish",desc:"All your users can see this quiz",value:"Published",icon:{icon:"mdi-public",size:"28"}}],Q=_(new Date().toISOString()),pe=l=>{s.value.attachments.push(...l),g.value=!1},j=_([]),fe=$e(),F=De(),X=()=>new Promise(async(l,o)=>{try{await Z();for(let f=0;f<j.value.length;f++){const{editor:p,id:V}=j.value[f],I=await p.save(),R=s.value.questions.findIndex(J=>J.id===V);s.value.questions[R].question=I}const w={};s.value.attachments.forEach(({type:f,id:p,name:V})=>w[p]={type:f,name:V});const T=await F.createQuiz({...s.value,questions:s.value.questions.map(({id:f,question:p,...V})=>({...V,question:JSON.stringify(p)})),attachments:w});v.value==="schedule"&&await F.scheduleQuiz(Number(T.data.id),Q.value),v.value==="publish"&&await F.publishQuiz(Number(T.data.id),D.value),l("ok")}catch(w){o(w)}}),_e=()=>{X().then(()=>{s.value={...H},s.value.attachments=[],s.value.questions=[],B.value.reset(),m.value=0,K()})},ve=()=>{X().then(()=>{fe.push({name:"quizzes"})})};return(l,o)=>{const w=Ce,T=Y("Media"),f=qe,p=Y("IconBtn"),V=ke,I=we,R=ye,J=he,Ve=be;return d(),z(P,null,[S("div",je,[e(w,{"current-step":i(m),items:G},null,8,["current-step"])]),e(Ne,{ref_key:"formEl",ref:B,class:"mt-5"},{default:t(()=>[e(Qe,{modelValue:i(m),"onUpdate:modelValue":o[7]||(o[7]=a=>U(m)?m.value=a:null),class:"disable-tab-transition"},{default:t(()=>[e(A,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(te,null,{default:t(()=>[e(N,{class:"pt-2"},{default:t(()=>[e(c,{cols:"12",sm:"8"},{default:t(()=>[e(E,{modelValue:i(s).title,"onUpdate:modelValue":o[0]||(o[0]=a=>i(s).title=a),rules:["requiredValidator"in l?l.requiredValidator:i($)],label:"Title"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"4"},{default:t(()=>[e(E,{modelValue:i(s).duration,"onUpdate:modelValue":o[1]||(o[1]=a=>i(s).duration=a),type:"number",rules:["requiredValidator"in l?l.requiredValidator:i($)],label:"Duration (minutes)","prepend-inner-icon":"tabler-clock"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(Te,{rows:"2","auto-grow":"",modelValue:i(s).description,"onUpdate:modelValue":o[2]||(o[2]=a=>i(s).description=a),rules:["requiredValidator"in l?l.requiredValidator:i($)],label:"Description"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(te,null,{default:t(()=>[e(N,null,{default:t(()=>[i(s).attachments.length?(d(!0),z(P,{key:0},M(i(s).attachments,(a,u)=>(d(),C(c,{cols:"12",sm:"6",md:"4",class:"h-100",key:a.id},{default:t(()=>[e(T,{media:a,deletable:"","aspect-ratio":"2/1","is-preview":"",onOnDelete:n=>ne(u)},null,8,["media","onOnDelete"])]),_:2},1024))),128)):x("",!0),e(c,{cols:"12",sm:"6",md:"4"},{default:t(()=>[e(f,{text:l.$t("media.upload.description")},{default:t(({props:a})=>[e(y,O({...a,...i(ze),style:"min-height: 150px;aspect-ratio:2/1"},{onClick:o[3]||(o[3]=u=>g.value=!0)}),{default:t(()=>[S("div",Fe,[e(q,{icon:"flat-color-icons:add-image",size:"28"}),e(Oe,{class:"mt-2"},{default:t(()=>[r(L(l.$t("media.attachment")),1)]),_:1})])]),_:2},1040)]),_:1},8,["text"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(N,null,{default:t(()=>[(d(!0),z(P,null,M(i(s).questions,(a,u)=>(d(),C(c,{cols:"12",key:u},{default:t(()=>[e(I,{"prepend-icon":"tabler-device-ipad-question",title:`${"Question "+(u+1)} - (${a.options.reduce((n,b)=>n+Number(b.points),0)} Points)`},{append:t(()=>[e(p,O({onClick:n=>re(u)},{variant:"text",density:"compact",color:"default"},{icon:"tabler-copy"}),null,16,["onClick"]),e(p,O({onClick:n=>ue(u)},{variant:"text",density:"compact",color:"error"},{icon:"tabler-trash"}),null,16,["onClick"])]),default:t(()=>[e(Ue,null,{default:t(()=>[e(N,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(V,{class:"border rounded pa-4",placeholder:"Type here your question "+(u+1),ref_for:!0,ref_key:"editorJs",ref:j,holder:a.id},null,8,["placeholder","holder"])]),_:2},1024),(d(!0),z(P,null,M(a.options,(n,b)=>(d(),C(c,{key:b,cols:"12"},{default:t(()=>[S("div",Ie,[e(E,{id:"option-"+(u+1)+"-"+(b+1),modelValue:n.option,"onUpdate:modelValue":k=>n.option=k,label:"Option "+(b+1),rules:["requiredValidator"in l?l.requiredValidator:i($)],"base-color":n.is_correct?"success":"default",class:"w-100"},null,8,["id","modelValue","onUpdate:modelValue","label","rules","base-color"]),n.is_correct?(d(),C(E,{key:0,id:"option-points-"+(u+1)+"-"+(b+1),type:"number",modelValue:n.points,"onUpdate:modelValue":k=>n.points=k,label:"Points",rules:["requiredValidator"in l?l.requiredValidator:i($)],"base-color":n.is_correct?"success":"default"},null,8,["id","modelValue","onUpdate:modelValue","rules","base-color"])):x("",!0),S("div",Re,[e(Ee,{color:"success",modelValue:n.is_correct,"onUpdate:modelValue":k=>n.is_correct=k},{default:t(()=>[e(W,{activator:"parent",location:"top"},{default:t(()=>[r(" Correct Answer ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),a.options.length>1?(d(),C(y,{key:1,onClick:k=>de(u,b),icon:"",density:"compact",color:"error",variant:"text"},{default:t(()=>[e(q,{icon:"tabler-trash"}),e(W,{activator:"parent",location:"top"},{default:t(()=>[r(" Delete Option ")]),_:1})]),_:2},1032,["onClick"])):x("",!0)])]),_:2},1024))),128)),e(c,{cols:"12"},{default:t(()=>[e(Be,{"model-value":a.allow_custom_answer,"onUpdate:modelValue":n=>a.allow_custom_answer=n,label:"Accept custom answers"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(Pe,{class:"ma-3"},{default:t(()=>[e(y,{onClick:n=>ce(u),variant:"tonal"},{default:t(()=>[r(" Add Option ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024))),128)),e(c,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[e(W,{location:"top"},{activator:t(({props:a})=>[e(p,O(a,{icon:"tabler-plus",variant:"tonal",onClick:K}),null,16)]),default:t(()=>[r(" Add Question ")]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(Ae,{modelValue:i(v),"onUpdate:modelValue":o[6]||(o[6]=a=>U(v)?v.value=a:null),mandatory:"force",variant:"accordion"},{default:t(()=>[e(ae,{value:"publish"},{default:t(()=>[e(oe,null,{default:t(()=>[e(q,{icon:"tabler:send",class:"mr-3"}),r(" Publish Quiz ")]),_:1}),e(le,{class:"mb-2"},{default:t(()=>[r(" Make your Quiz public or private ")]),_:1}),e(se,{class:"mt-5"},{default:t(()=>[e(R,{"selected-radio":i(D),"onUpdate:selectedRadio":o[4]||(o[4]=a=>U(D)?D.value=a:null),"radio-content":me,"grid-column":{md:"6"}},null,8,["selected-radio"])]),_:1})]),_:1}),e(ae,{value:"schedule"},{default:t(()=>[e(oe,null,{default:t(()=>[e(q,{icon:"tabler:calendar",class:"mr-3"}),r(" Schedule Quiz ")]),_:1}),e(le,{class:"mb-2"},{default:t(()=>[r(" Select a date to make your Quiz public. ")]),_:1}),e(se,null,{default:t(()=>[e(J,{modelValue:i(Q),"onUpdate:modelValue":o[5]||(o[5]=a=>U(Q)?Q.value=a:null),style:{width:"min-content"},config:{inline:!0,enableTime:!0,dateFormat:"Z"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),S("div",Je,[e(y,{color:"secondary",variant:"tonal",disabled:i(m)===0,onClick:o[8]||(o[8]=a=>m.value--)},{default:t(()=>[e(q,{icon:"tabler-arrow-left",start:"",class:"flip-in-rtl"}),r(" Previous ")]),_:1},8,["disabled"]),G.length-1===i(m)?(d(),z(P,{key:0},[e(Se),e(y,{onClick:_e,variant:"outlined",color:"success"},{default:t(()=>[r(L(l.$t(i(v)))+" & Start New Quiz ",1)]),_:1}),e(y,{onClick:ve,color:"success"},{default:t(()=>[r(L(l.$t(i(v))),1)]),_:1})],64)):(d(),C(y,{key:1,onClick:ie},{default:t(()=>[r(" Next "),e(q,{icon:"tabler-arrow-right",end:"",class:"flip-in-rtl"})]),_:1}))])]),_:1},512),e(Ve,{"is-dialog-visible":i(g),"onUpdate:isDialogVisible":o[9]||(o[9]=a=>U(g)?g.value=a:null),"allowed-file-types":["image/*",".pdf","video/*"],onDone:pe},null,8,["is-dialog-visible","allowed-file-types"])],64)}}});export{kt as default};
