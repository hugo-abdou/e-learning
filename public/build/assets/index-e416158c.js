import{_ as Z}from"./AppTextField.vue_vue_type_script_setup_true_lang-6a6ad41d.js";import{_ as ee}from"./AppSelect.vue_vue_type_script_setup_true_lang-4b71649a.js";import{u as G}from"./useUserListStore-6d7532e1.js";import{d as H,r as n,b5 as J,w as K,o as C,h as T,f as l,b as a,be as W,q as t,b0 as U,bc as ae,aj as S,x as g,b8 as X,c3 as te,b4 as j,c4 as le,a as se,c as O,e as y,y as f,bb as oe,bh as re,F as ne,j as ie,a0 as A,t as M}from"./main-dd42a7da.js";import{e as de,p as ue}from"./utils-d59cd350.js";import{r as B,e as me}from"./validators-753247d6.js";import{_ as Y}from"./RolesSelectBox.vue_vue_type_script_setup_true_lang-063fb638.js";import{V as pe}from"./VForm-a596e7af.js";import{V as F,a as b}from"./VRow-fd71155e.js";import{V as L}from"./VTextField-5a655f9e.js";import{a as fe}from"./formatters-386d1040.js";import{l as ce}from"./lodash-b16277ae.js";import{V as z}from"./VDivider-730dc40b.js";import{V as ve}from"./VDataTableServer-7f29353a.js";import{V as Ve}from"./VMenu-02af41c3.js";import{V as ge,a as E,b as q}from"./VList-dcf79c63.js";import{V as be}from"./VPagination-8f778ca8.js";import{V as _e}from"./VChip-36ee8e62.js";import{b as Q}from"./route-block-83d24a4e.js";import"./VInput-842a483e.js";import"./VSelect-609e0bfd.js";import"./VCheckboxBtn-3cb8d0e7.js";import"./VSelectionControl-819e6b68.js";import"./useRolesStore-aa747f23.js";import"./VField-82170d56.js";import"./VTable-82ff6af5.js";const we=H({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,default:!1},brand:{},disabledRoles:{type:Boolean},defaultRoles:{}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:R}){const u=I,m=R,_=n(!1),D=n(!1),c=n(!1),v=n(),h=n(""),o=n(""),P=n(""),w=n(),x=n({name:void 0,email:void 0,password:void 0}),k=()=>{j(()=>{var i,e;(i=v.value)==null||i.reset(),(e=v.value)==null||e.resetValidation(),x.value={name:void 0,email:void 0,password:void 0}})},N=()=>{m("update:isDrawerOpen",!1),p.refreshUser(),j(()=>{var i,e;(i=v.value)==null||i.reset(),(e=v.value)==null||e.resetValidation()})},r=G(),s=()=>{var i;D.value=!0,(i=v.value)==null||i.validate().then(async({valid:e})=>{if(e){try{const V=await r.addUser({name:h.value,email:o.value,role:[],password:P.value,password_confirmation:P.value,terms:!0});m("userData",V.data),m("update:isDrawerOpen",!1),k()}catch(V){V.response.status===422&&(x.value=V.response.data.errors)}D.value=!1}})},$=i=>{m("update:isDrawerOpen",i)},p=J();return K(()=>u.isDrawerOpen,i=>{u.defaultRoles&&(w.value=u.defaultRoles)}),(i,e)=>{const V=le;return C(),T(te,{width:i.$vuetify.display.smAndDown?"auto":677,"model-value":u.isDrawerOpen,"onUpdate:modelValue":$},{default:l(()=>[a(V,{onClick:N}),a(X,{title:"Create New User",subtitle:"Created user details will receive a privacy audit."},{default:l(()=>[a(W,null,{default:l(()=>[a(t(pe),{ref_key:"refForm",ref:v,modelValue:t(c),"onUpdate:modelValue":e[5]||(e[5]=d=>U(c)?c.value=d:null),onSubmit:ae(s,["prevent"])},{default:l(()=>[a(F,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(h),"onUpdate:modelValue":e[0]||(e[0]=d=>U(h)?h.value=d:null),rules:[t(B)],label:"Full Name","error-messages":t(x).name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>U(o)?o.value=d:null),rules:[t(B),t(me)],label:"Email","error-messages":t(x).email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=d=>U(P)?P.value=d:null),label:"Password",rules:[t(B)],type:t(_)?"text":"password","append-inner-icon":t(_)?"tabler-eye-off":"tabler-eye","error-messages":t(x).password,"onClick:appendInner":e[3]||(e[3]=d=>_.value=!t(_))},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(Y,{modelValue:t(w),"onUpdate:modelValue":e[4]||(e[4]=d=>U(w)?w.value=d:null),rules:[t(B)]},null,8,["modelValue","rules"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(S,{type:"submit",class:"me-3",loading:t(D),disabled:t(D)},{default:l(()=>[g(" Submit ")]),_:1},8,["loading","disabled"]),a(S,{type:"reset",variant:"tonal",color:"secondary",onClick:N},{default:l(()=>[g(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}}),ye={class:"d-flex justify-end flex-wrap gap-4"},Ue={class:"d-flex align-center"},Pe={key:1},xe={class:"d-flex flex-column"},De={class:"text-base"},he={class:"text-sm text-medium-emphasis"},ke={class:"d-flex gap-1 py-2 flex-wrap w-100"},$e={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-disabled mb-0"},Se=H({__name:"index",setup(I){const R=G(),u=n(""),m=n("all"),_=J(),D=n(1),c=n(0),v=n([]),h=n([]),o=n({page:1,itemsPerPage:10,sortBy:[],groupBy:[],search:void 0}),P=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Roles",key:"role",sortable:!1},{title:"",key:"actions",sortable:!1,width:"70"}],w=ce.debounce(async()=>{var r,s,$;try{const p=await R.fetchUsers({q:u.value,role:m.value,...o.value});v.value=p.data,D.value=((r=p.meta)==null?void 0:r.to)||0,c.value=((s=p.meta)==null?void 0:s.total)||0,o.value.page=(($=p.meta)==null?void 0:$.current_page)||0}catch(p){console.log(p)}},500),x=()=>{w(),_.refreshUser()},k=n(!1),N=r=>{confirm("Are you sure you want to deactivate your account?")&&R.deleteUser(r).then(w)};return K([o,u,m,()=>o.value.itemsPerPage],w),(r,s)=>{const $=ee,p=Z,i=se("RouterLink");return C(),O("section",null,[a(F,null,{default:l(()=>[a(b,{cols:"12"},{default:l(()=>[a(X,{title:r.$t("Users")},{default:l(()=>[a(W,null,{default:l(()=>[a(F,{align:"end",justify:"space-between"},{default:l(()=>[a(b,{cols:"12",sm:"4"},{default:l(()=>[a(Y,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=e=>U(m)?m.value=e:null),"default-roles":t(h),label:r.$t("Select Role"),multiple:!1,clearable:""},null,8,["modelValue","default-roles","label"])]),_:1}),a(b,{cols:"12",sm:"4"},{default:l(()=>[a($,{label:r.$t("Items Per Page"),"model-value":t(o).itemsPerPage,items:[10,20,50,100],"onUpdate:modelValue":s[1]||(s[1]=e=>t(o).itemsPerPage=parseInt(e,10))},null,8,["label","model-value"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(b,{class:"d-flex gap-5"},{default:l(()=>[a(p,{modelValue:t(u),"onUpdate:modelValue":s[2]||(s[2]=e=>U(u)?u.value=e:null),placeholder:r.$t("Search"),density:"compact"},null,8,["modelValue","placeholder"]),y("div",ye,[a(S,{"prepend-icon":"tabler-plus",onClick:s[3]||(s[3]=e=>k.value=!0)},{default:l(()=>[g(f(r.$t("Add New User")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(z),a(t(ve),{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":s[6]||(s[6]=e=>t(o).page=e),items:t(v),"items-length":t(c),headers:P.map(e=>({...e,title:r.$t(e.title)})),class:"text-no-wrap","onUpdate:options":s[7]||(s[7]=e=>o.value=e)},{"item.name":l(({item:e})=>[y("div",Ue,[a(oe,{size:"34",variant:e.avatar?void 0:"tonal",class:"me-3",color:e.avatar?void 0:t(de)(e.role).color},{default:l(()=>[e.avatar?(C(),T(re,{key:0,src:e.avatar},null,8,["src"])):(C(),O("span",Pe,f(t(fe)(e.name)),1))]),_:2},1032,["variant","color"]),y("div",xe,[y("h6",De,[a(i,{to:t(_).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}},class:"font-weight-medium user-list-name"},{default:l(()=>[g(f(e.name),1)]),_:2},1032,["to"])]),y("span",he,f(e.email),1)])])]),"item.role":l(({item:e})=>[y("div",ke,[(C(!0),O(ne,null,ie(e.role,(V,d)=>(C(),T(_e,{key:d,label:"",size:"small",color:"default",density:"comfortable"},{default:l(()=>[g(f(V),1)]),_:2},1024))),128))])]),"item.actions":l(({item:e})=>[a(S,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:l(()=>[a(A,{size:"24",icon:"tabler-dots-vertical"}),a(Ve,{activator:"parent"},{default:l(()=>[a(ge,null,{default:l(()=>[a(E,{to:t(_).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}}},{prepend:l(()=>[a(A,{icon:"tabler-eye"})]),default:l(()=>[a(q,null,{default:l(()=>[g(f(r.$t("View")),1)]),_:1})]),_:2},1032,["to"]),a(E,{onClick:V=>N(e.id)},{prepend:l(()=>[a(A,{icon:"tabler-trash"})]),default:l(()=>[a(q,null,{default:l(()=>[g(f(r.$t("Delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[a(z),y("div",$e,[y("p",Ce,f(t(ue)(t(o),t(c))),1),a(be,{"model-value":t(o).page,length:Math.ceil(t(c)/t(o).itemsPerPage),"total-visible":r.$vuetify.display.xs?1:Math.ceil(t(c)/t(o).itemsPerPage),"onUpdate:modelValue":s[4]||(s[4]=e=>o.value={...t(o),page:e})},{prev:l(e=>[a(S,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[g(f(r.$t("Previous")),1)]),_:2},1040)]),next:l(e=>[a(S,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[g(f(r.$t("Next")),1)]),_:2},1040)]),_:1},8,["model-value","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1},8,["title"]),a(we,{isDrawerOpen:t(k),"onUpdate:isDrawerOpen":s[8]||(s[8]=e=>U(k)?k.value=e:null),"default-roles":["user"],onUserData:x},null,8,["isDrawerOpen"])]),_:1})]),_:1})])}}});typeof Q=="function"&&Q(Se);export{Se as default};
