import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-a5454b40.js";import{_ as ee}from"./AppSelect.vue_vue_type_script_setup_true_lang-1b0eea88.js";import{u as Q}from"./useUserListStore-1366432a.js";import{d as Z,r as n,bf as G,w as H,o as C,h as I,f as l,b as a,bw as K,p as t,bb as U,bm as ae,aj as S,v as b,bi as W,bI as te,aZ as j,bJ as le,a as se,c as O,e as y,x as f,bl as oe,bz as re,F as ne,j as ie,a0 as A,s as M}from"./main-b48d3f12.js";import{e as de,p as ue}from"./utils-676f4eba.js";import{r as B,e as me}from"./validators-f52bbb1d.js";import{_ as X}from"./RolesSelectBox.vue_vue_type_script_setup_true_lang-7f8c9913.js";import{V as pe}from"./VForm-8f8030b9.js";import{V as F,a as g}from"./VRow-932bb168.js";import{V as L}from"./VTextField-2354732d.js";import{a as fe}from"./formatters-386d1040.js";import{l as ce}from"./lodash-1a3e456e.js";import{V as z}from"./VDivider-587288bc.js";import{V as ve}from"./VDataTableServer-91929da7.js";import{V as Ve}from"./VMenu-4188ebde.js";import{V as be,a as E,b as q}from"./VList-b374d8f4.js";import{V as ge}from"./VPagination-409ad022.js";import{V as _e}from"./VChip-dc7e3cd5.js";import{b as J}from"./route-block-83d24a4e.js";import"./VInput-24d6cb1c.js";import"./VSelect-546d8962.js";import"./VCheckboxBtn-fae3c603.js";import"./VSelectionControl-e09c0678.js";import"./VField-cbd8c123.js";import"./VTable-47952bee.js";const we=Z({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,default:!1},brand:{},disabledRoles:{type:Boolean},defaultRoles:{}},emits:["update:isDrawerOpen","userData"],setup(T,{emit:R}){const u=T,m=R,_=n(!1),D=n(!1),c=n(!1),v=n(),k=n(""),o=n(""),P=n(""),w=n(),x=n({name:void 0,email:void 0,password:void 0}),h=()=>{j(()=>{var i,e;(i=v.value)==null||i.reset(),(e=v.value)==null||e.resetValidation(),x.value={name:void 0,email:void 0,password:void 0}})},N=()=>{m("update:isDrawerOpen",!1),p.refreshUser(),j(()=>{var i,e;(i=v.value)==null||i.reset(),(e=v.value)==null||e.resetValidation()})},r=Q(),s=()=>{var i;D.value=!0,(i=v.value)==null||i.validate().then(async({valid:e})=>{if(e){try{const V=await r.addUser({name:k.value,email:o.value,role:[],password:P.value,password_confirmation:P.value,terms:!0});m("userData",V.data),m("update:isDrawerOpen",!1),h()}catch(V){V.response.status===422&&(x.value=V.response.data.errors)}D.value=!1}})},$=i=>{m("update:isDrawerOpen",i)},p=G();return H(()=>u.isDrawerOpen,i=>{u.defaultRoles&&(w.value=u.defaultRoles)}),(i,e)=>{const V=le;return C(),I(te,{width:i.$vuetify.display.smAndDown?"auto":677,"model-value":u.isDrawerOpen,"onUpdate:modelValue":$},{default:l(()=>[a(V,{onClick:N}),a(W,{title:"Create New User",subtitle:"Created user details will receive a privacy audit."},{default:l(()=>[a(K,null,{default:l(()=>[a(t(pe),{ref_key:"refForm",ref:v,modelValue:t(c),"onUpdate:modelValue":e[5]||(e[5]=d=>U(c)?c.value=d:null),onSubmit:ae(s,["prevent"])},{default:l(()=>[a(F,null,{default:l(()=>[a(g,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(k),"onUpdate:modelValue":e[0]||(e[0]=d=>U(k)?k.value=d:null),rules:[t(B)],label:"Full Name","error-messages":t(x).name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(g,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>U(o)?o.value=d:null),rules:[t(B),t(me)],label:"Email","error-messages":t(x).email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(g,{cols:"12",md:"6"},{default:l(()=>[a(L,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=d=>U(P)?P.value=d:null),label:"Password",rules:[t(B)],type:t(_)?"text":"password","append-inner-icon":t(_)?"tabler-eye-off":"tabler-eye","error-messages":t(x).password,"onClick:appendInner":e[3]||(e[3]=d=>_.value=!t(_))},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1}),a(g,{cols:"12",md:"6"},{default:l(()=>[a(X,{modelValue:t(w),"onUpdate:modelValue":e[4]||(e[4]=d=>U(w)?w.value=d:null),rules:[t(B)]},null,8,["modelValue","rules"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(S,{type:"submit",class:"me-3",loading:t(D),disabled:t(D)},{default:l(()=>[b(" Submit ")]),_:1},8,["loading","disabled"]),a(S,{type:"reset",variant:"tonal",color:"secondary",onClick:N},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}}),ye={class:"d-flex justify-end flex-wrap gap-4"},Ue={class:"d-flex align-center"},Pe={key:1},xe={class:"d-flex flex-column"},De={class:"text-base"},ke={class:"text-sm text-medium-emphasis"},he={class:"d-flex gap-1 py-2 flex-wrap w-100"},$e={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-disabled mb-0"},Se=Z({__name:"index",setup(T){const R=Q(),u=n(""),m=n("all"),_=G(),D=n(1),c=n(0),v=n([]),k=n([]),o=n({page:1,itemsPerPage:10,sortBy:[],groupBy:[],search:void 0}),P=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Roles",key:"role",sortable:!1},{title:"",key:"actions",sortable:!1,width:"70"}],w=ce.debounce(async()=>{var r,s,$;try{const p=await R.fetchUsers({q:u.value,role:m.value,...o.value});v.value=p.data,D.value=((r=p.meta)==null?void 0:r.to)||0,c.value=((s=p.meta)==null?void 0:s.total)||0,o.value.page=(($=p.meta)==null?void 0:$.current_page)||0}catch(p){console.log(p)}},500),x=()=>{w(),_.refreshUser()},h=n(!1),N=r=>{confirm("Are you sure you want to deactivate your account?")&&R.deleteUser(r).then(w)};return H([o,u,m,()=>o.value.itemsPerPage],w),(r,s)=>{const $=ee,p=Y,i=se("RouterLink");return C(),O("section",null,[a(F,null,{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[a(W,{title:r.$t("Users")},{default:l(()=>[a(K,null,{default:l(()=>[a(F,{align:"end",justify:"space-between"},{default:l(()=>[a(g,{cols:"12",sm:"4"},{default:l(()=>[a(X,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=e=>U(m)?m.value=e:null),"default-roles":t(k),label:r.$t("Select Role"),multiple:!1,clearable:""},null,8,["modelValue","default-roles","label"])]),_:1}),a(g,{cols:"12",sm:"4"},{default:l(()=>[a($,{label:r.$t("Items Per Page"),"model-value":t(o).itemsPerPage,items:[10,20,50,100],"onUpdate:modelValue":s[1]||(s[1]=e=>t(o).itemsPerPage=parseInt(e,10))},null,8,["label","model-value"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(g,{class:"d-flex gap-5"},{default:l(()=>[a(p,{modelValue:t(u),"onUpdate:modelValue":s[2]||(s[2]=e=>U(u)?u.value=e:null),placeholder:r.$t("Search"),density:"compact"},null,8,["modelValue","placeholder"]),y("div",ye,[a(S,{"prepend-icon":"tabler-plus",onClick:s[3]||(s[3]=e=>h.value=!0)},{default:l(()=>[b(f(r.$t("Add New User")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(z),a(t(ve),{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":s[6]||(s[6]=e=>t(o).page=e),items:t(v),"items-length":t(c),headers:P.map(e=>({...e,title:r.$t(e.title)})),class:"text-no-wrap","onUpdate:options":s[7]||(s[7]=e=>o.value=e)},{"item.name":l(({item:e})=>[y("div",Ue,[a(oe,{size:"34",variant:e.avatar?void 0:"tonal",class:"me-3",color:e.avatar?void 0:t(de)(e.role).color},{default:l(()=>[e.avatar?(C(),I(re,{key:0,src:e.avatar},null,8,["src"])):(C(),O("span",Pe,f(t(fe)(e.name)),1))]),_:2},1032,["variant","color"]),y("div",xe,[y("h6",De,[a(i,{to:t(_).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}},class:"font-weight-medium user-list-name"},{default:l(()=>[b(f(e.name),1)]),_:2},1032,["to"])]),y("span",ke,f(e.email),1)])])]),"item.role":l(({item:e})=>[y("div",he,[(C(!0),O(ne,null,ie(e.role,(V,d)=>(C(),I(_e,{key:d,label:"",size:"small",color:"default",density:"comfortable"},{default:l(()=>[b(f(V),1)]),_:2},1024))),128))])]),"item.actions":l(({item:e})=>[a(S,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:l(()=>[a(A,{size:"24",icon:"tabler-dots-vertical"}),a(Ve,{activator:"parent"},{default:l(()=>[a(be,null,{default:l(()=>[a(E,{to:t(_).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}}},{prepend:l(()=>[a(A,{icon:"tabler-eye"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("View")),1)]),_:1})]),_:2},1032,["to"]),a(E,{onClick:V=>N(e.id)},{prepend:l(()=>[a(A,{icon:"tabler-trash"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("Delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[a(z),y("div",$e,[y("p",Ce,f(t(ue)(t(o),t(c))),1),a(ge,{"model-value":t(o).page,length:Math.ceil(t(c)/t(o).itemsPerPage),"total-visible":r.$vuetify.display.xs?1:Math.ceil(t(c)/t(o).itemsPerPage),"onUpdate:modelValue":s[4]||(s[4]=e=>o.value={...t(o),page:e})},{prev:l(e=>[a(S,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Previous")),1)]),_:2},1040)]),next:l(e=>[a(S,M({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Next")),1)]),_:2},1040)]),_:1},8,["model-value","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1},8,["title"]),a(we,{isDrawerOpen:t(h),"onUpdate:isDrawerOpen":s[8]||(s[8]=e=>U(h)?h.value=e:null),"default-roles":["user"],onUserData:x},null,8,["isDrawerOpen"])]),_:1})]),_:1})])}}});typeof J=="function"&&J(Se);export{Se as default};
