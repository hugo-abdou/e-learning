import{r as S}from"./validators-6e538dce.js";import{_ as ve}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-cb04a084.js";import{_ as Ve}from"./DateTimePicker.vue_vue_type_style_index_0_lang-bd1c41b3.js";import{_ as be}from"./CustomRadiosWithIcon-e146887b.js";import{_ as ye}from"./CollapsedContent.vue_vue_type_script_setup_true_lang-ea3a60a9.js";import{_ as he}from"./EditorJs.vue_vue_type_style_index_0_lang-aabb8209.js";import{_ as we}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-947f9f5f.js";import{_ as ke}from"./AppStepper.vue_vue_type_style_index_0_lang-d10ff415.js";import{M as qe}from"./index-0a5c7226.js";import{u as y,U as Ce}from"./utils-75e2a70f.js";import{s as ge}from"./slugify-624934a4.js";import{t as Se,r as _,a4 as Ue,S as ze,v as d,x as U,D as z,n as e,H as i,A as t,L as $,F as P,y as J,a2 as L,B as h,s as A,C as q,aa as n,E as M,z as C}from"./plugins-20f6c63a.js";import{u as $e}from"./useQuizzesStore-3b136e41.js";import{a as Pe,b as O}from"./VWindowItem-e6809476.js";import{V as Y,c as ee,a as De}from"./VCard-30e4f82a.js";import{V as te}from"./VCardText-d52ac2bc.js";import{V as E,a as m}from"./VRow-9970c9d9.js";import{V as N}from"./VTextField-24d0bc09.js";import{V as Qe}from"./VTextarea-de0927b7.js";import{b as Te}from"./VInput-df115ab9.js";import{V as W}from"./VTooltip-56957888.js";import{V as Ae,a as le,b as oe,c as ae}from"./VExpansionPanel-1a39f22b.js";import{V as Oe}from"./VSpacer-65846308.js";import{V as Ee}from"./VForm-d5279851.js";import{V as Ne}from"./VCheckbox-d809b236.js";import{V as Be}from"./VSwitch-94970a91.js";import{V as Fe}from"./VCardActions-aebc9678.js";import"./VCheckboxBtn-2871d378.js";import"./VSelectionControl-32c86160.js";import"./AppTextField.vue_vue_type_script_setup_true_lang-5a82d17e.js";import"./lodash-f6b38868.js";import"./_commonjsHelpers-de833af9.js";import"./VToolbar-c437b776.js";import"./index-755f2f9e.js";import"./preact.module-7f17e2b0.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-58e41beb.js";import"./VDialog-b5e757d9.js";import"./VOverlay-d4a32956.js";import"./forwardRefs-6ea3df5c.js";import"./scopeId-3cd861c8.js";import"./dialog-transition-beb6505c.js";import"./component-4b1ed0a8.js";import"./VField-78f5f7c6.js";import"./VRadioGroup-8e0340eb.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VSlideGroup-ee562ac5.js";import"./VSlideGroupItem-e87cf79c.js";import"./VSkeletonLoader-eb9e7f48.js";import"./VChip-99c6b32d.js";import"./VAvatar-d93e5e0c.js";import"./VPagination-32d7de4c.js";import"./ssrBoot-2d263cb5.js";import"./createSimpleFunctional-991d7489.js";const Ie={class:"mb-6"},Re={class:"d-flex flex-column align-center"},je={class:"d-flex align-start gap-2"},xe={class:"ml-4",style:{width:"40px"}},Je={class:"d-flex flex-wrap gap-4 justify-sm-space-between justify-center mt-8"},Lt=Se({__name:"create",setup(Le){const H=[{title:"Details",icon:"tabler-list-details"},{title:"Attachments",icon:"tabler-paperclip"},{title:"Questions",icon:"tabler-device-ipad-question"},{title:"Visibility",icon:"tabler-eye"}],p=_(0),B=_({}),Z=async()=>{const{valid:l,errors:a}=await B.value.validate();return l?Promise.resolve():Promise.reject(a)},se=()=>{Z().then(()=>p.value++)},G={title:"",description:"",duration:5,status:"Draft",attachments:[],questions:[{id:y(),allow_custom_answer:!1,question:{},options:[{id:y(),option:"",points:0,is_correct:!1}]}]},s=_({...G}),g=_(!1),ie=l=>{s.value.attachments.splice(l,1)},re=l=>{s.value.questions.push({...s.value.questions[l],id:y(),options:s.value.questions[l].options.map(a=>({...a,id:y()}))})},ne=l=>{s.value.questions.splice(l,1)},K=()=>{s.value.questions.push({id:y(),allow_custom_answer:!1,question:{},options:[{id:y(),option:"",points:0,is_correct:!1}]})},ue=(l,a)=>{s.value.questions[l].options.splice(a,1)},de=l=>{s.value.questions[l].options.push({id:y(),option:"",points:0,is_correct:!1})},v=_("publish"),D=_("Private"),ce=[{title:"Private",desc:"Only you see can this quiz",value:"Private",icon:{icon:"carbon:virtual-private-cloud",size:"28"}},{title:"Publish",desc:"All your users can see this quiz",value:"Published",icon:{icon:"mdi-public",size:"28"}}],Q=_(new Date().toISOString()),me=l=>{s.value.attachments.push(...l),g.value=!1},F=_([]),pe=Ue(),I=$e(),X=()=>new Promise(async(l,a)=>{try{await Z();for(let c=0;c<F.value.length;c++){const{editor:V,id:f}=F.value[c],R=await V.save(),j=s.value.questions.findIndex(x=>x.id===f);s.value.questions[j].question=R}const w={};s.value.attachments.forEach(({type:c,id:V,name:f})=>w[V]={type:c,name:f,slug:ge(f)});const T=await I.createQuiz({...s.value,questions:s.value.questions.map(({id:c,question:V,...f})=>({...f,question:JSON.stringify(V)})),attachments:w});v.value==="schedule"&&await I.scheduleQuiz(Number(T.data.id),Q.value),v.value==="publish"&&await I.publishQuiz(Number(T.data.id),D.value),l("ok")}catch(w){a(w)}}),fe=()=>{X().then(()=>{s.value={...G},s.value.attachments=[],s.value.questions=[],B.value.reset(),p.value=0,K()})},_e=()=>{X().then(()=>{pe.push({name:"quizzes"})})};return(l,a)=>{const w=ke,T=we,c=ze("IconBtn"),V=he,f=ye,R=be,j=Ve,x=ve;return d(),U(P,null,[z("div",Ie,[e(w,{"current-step":i(p),items:H},null,8,["current-step"])]),e(Ee,{ref_key:"formEl",ref:B,class:"mt-5"},{default:t(()=>[e(Pe,{modelValue:i(p),"onUpdate:modelValue":a[7]||(a[7]=o=>$(p)?p.value=o:null),class:"disable-tab-transition"},{default:t(()=>[e(O,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(te,null,{default:t(()=>[e(E,{class:"pt-2"},{default:t(()=>[e(m,{cols:"12",sm:"8"},{default:t(()=>[e(N,{modelValue:i(s).title,"onUpdate:modelValue":a[0]||(a[0]=o=>i(s).title=o),rules:["requiredValidator"in l?l.requiredValidator:i(S)],label:"Title"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",sm:"4"},{default:t(()=>[e(N,{modelValue:i(s).duration,"onUpdate:modelValue":a[1]||(a[1]=o=>i(s).duration=o),type:"number",rules:["requiredValidator"in l?l.requiredValidator:i(S)],label:"Duration (minutes)","prepend-inner-icon":"tabler-clock"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(Qe,{rows:"2","auto-grow":"",modelValue:i(s).description,"onUpdate:modelValue":a[2]||(a[2]=o=>i(s).description=o),rules:["requiredValidator"in l?l.requiredValidator:i(S)],label:"Description"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(te,null,{default:t(()=>[e(E,null,{default:t(()=>[i(s).attachments.length?(d(!0),U(P,{key:0},J(i(s).attachments,(o,u)=>(d(),C(m,{cols:"12",sm:"6",md:"4",class:"h-100",key:o.id},{default:t(()=>[e(i(qe),{media:o,deletable:"","aspect-ratio":"2/1","is-preview":"",onOnDelete:r=>ie(u)},null,8,["media","onOnDelete"])]),_:2},1024))),128)):L("",!0),e(m,{cols:"12",sm:"6",md:"4"},{default:t(()=>[e(T,{text:l.$t("media.upload.description")},{default:t(({props:o})=>[e(h,A({...o,...i(Ce),style:"min-height: 150px;aspect-ratio:2/1"},{onClick:a[3]||(a[3]=u=>g.value=!0)}),{default:t(()=>[z("div",Re,[e(q,{icon:"flat-color-icons:add-image",size:"28"}),e(Te,{class:"mt-2"},{default:t(()=>[n(M(l.$t("media.attachment")),1)]),_:1})])]),_:2},1040)]),_:1},8,["text"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(E,null,{default:t(()=>[(d(!0),U(P,null,J(i(s).questions,(o,u)=>(d(),C(m,{cols:"12",key:u},{default:t(()=>[e(f,{"prepend-icon":"tabler-device-ipad-question",title:`${"Question "+(u+1)} - (${o.options.reduce((r,b)=>r+Number(b.points),0)} Points)`},{append:t(()=>[e(c,A({onClick:r=>re(u)},{variant:"text",density:"compact",color:"default"},{icon:"tabler-copy"}),null,16,["onClick"]),e(c,A({onClick:r=>ne(u)},{variant:"text",density:"compact",color:"error"},{icon:"tabler-trash"}),null,16,["onClick"])]),default:t(()=>[e(De,null,{default:t(()=>[e(E,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(V,{class:"border rounded pa-4",placeholder:"Type here your question "+(u+1),ref_for:!0,ref_key:"editorJs",ref:F,holder:o.id},null,8,["placeholder","holder"])]),_:2},1024),(d(!0),U(P,null,J(o.options,(r,b)=>(d(),C(m,{key:b,cols:"12"},{default:t(()=>[z("div",je,[e(N,{id:"option-"+(u+1)+"-"+(b+1),modelValue:r.option,"onUpdate:modelValue":k=>r.option=k,label:"Option "+(b+1),rules:["requiredValidator"in l?l.requiredValidator:i(S)],"base-color":r.is_correct?"success":"default",class:"w-100"},null,8,["id","modelValue","onUpdate:modelValue","label","rules","base-color"]),r.is_correct?(d(),C(N,{key:0,id:"option-points-"+(u+1)+"-"+(b+1),type:"number",modelValue:r.points,"onUpdate:modelValue":k=>r.points=k,label:"Points",rules:["requiredValidator"in l?l.requiredValidator:i(S)],"base-color":r.is_correct?"success":"default"},null,8,["id","modelValue","onUpdate:modelValue","rules","base-color"])):L("",!0),z("div",xe,[e(Ne,{color:"success",modelValue:r.is_correct,"onUpdate:modelValue":k=>r.is_correct=k},{default:t(()=>[e(W,{activator:"parent",location:"top"},{default:t(()=>[n(" Correct Answer ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),o.options.length>1?(d(),C(h,{key:1,onClick:k=>ue(u,b),icon:"",density:"compact",color:"error",variant:"text"},{default:t(()=>[e(q,{icon:"tabler-trash"}),e(W,{activator:"parent",location:"top"},{default:t(()=>[n(" Delete Option ")]),_:1})]),_:2},1032,["onClick"])):L("",!0)])]),_:2},1024))),128)),e(m,{cols:"12"},{default:t(()=>[e(Be,{"model-value":o.allow_custom_answer,"onUpdate:modelValue":r=>o.allow_custom_answer=r,label:"Accept custom answers"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(Fe,{class:"ma-3"},{default:t(()=>[e(h,{onClick:r=>de(u),variant:"tonal"},{default:t(()=>[n(" Add Option ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024))),128)),e(m,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[e(W,{location:"top"},{activator:t(({props:o})=>[e(c,A(o,{icon:"tabler-plus",variant:"tonal",onClick:K}),null,16)]),default:t(()=>[n(" Add Question ")]),_:1})]),_:1})]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(Ae,{modelValue:i(v),"onUpdate:modelValue":a[6]||(a[6]=o=>$(v)?v.value=o:null),mandatory:"force",variant:"accordion"},{default:t(()=>[e(le,{value:"publish"},{default:t(()=>[e(oe,null,{default:t(()=>[e(q,{icon:"tabler:send",class:"mr-3"}),n(" Publish Quiz ")]),_:1}),e(ee,{class:"mb-2"},{default:t(()=>[n(" Make your Quiz public or private ")]),_:1}),e(ae,{class:"mt-5"},{default:t(()=>[e(R,{"selected-radio":i(D),"onUpdate:selectedRadio":a[4]||(a[4]=o=>$(D)?D.value=o:null),"radio-content":ce,"grid-column":{md:"6"}},null,8,["selected-radio"])]),_:1})]),_:1}),e(le,{value:"schedule"},{default:t(()=>[e(oe,null,{default:t(()=>[e(q,{icon:"tabler:calendar",class:"mr-3"}),n(" Schedule Quiz ")]),_:1}),e(ee,{class:"mb-2"},{default:t(()=>[n(" Select a date to make your Quiz public. ")]),_:1}),e(ae,null,{default:t(()=>[e(j,{modelValue:i(Q),"onUpdate:modelValue":a[5]||(a[5]=o=>$(Q)?Q.value=o:null),style:{width:"min-content"},config:{inline:!0,enableTime:!0,dateFormat:"Z"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),z("div",Je,[e(h,{color:"secondary",variant:"tonal",disabled:i(p)===0,onClick:a[8]||(a[8]=o=>p.value--)},{default:t(()=>[e(q,{icon:"tabler-arrow-left",start:"",class:"flip-in-rtl"}),n(" Previous ")]),_:1},8,["disabled"]),H.length-1===i(p)?(d(),U(P,{key:0},[e(Oe),e(h,{onClick:fe,variant:"outlined",color:"success"},{default:t(()=>[n(M(l.$t(i(v)))+" & Start New Quiz ",1)]),_:1}),e(h,{onClick:_e,color:"success"},{default:t(()=>[n(M(l.$t(i(v))),1)]),_:1})],64)):(d(),C(h,{key:1,onClick:se},{default:t(()=>[n(" Next "),e(q,{icon:"tabler-arrow-right",end:"",class:"flip-in-rtl"})]),_:1}))])]),_:1},512),e(x,{"is-dialog-visible":i(g),"onUpdate:isDialogVisible":a[9]||(a[9]=o=>$(g)?g.value=o:null),"allowed-file-types":["image/*",".pdf","video/*"],onDone:me},null,8,["is-dialog-visible","allowed-file-types"])],64)}}});export{Lt as default};
