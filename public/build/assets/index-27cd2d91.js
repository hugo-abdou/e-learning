import{_ as Z}from"./AppTextField.vue_vue_type_script_setup_true_lang-c26bd8aa.js";import{_ as ee}from"./AppSelect.vue_vue_type_script_setup_true_lang-0587ea51.js";import{u as G}from"./useUserListStore-fa84f5c7.js";import{d as H,r as n,a0 as J,w as K,o as D,h as F,f as l,b as a,be as W,q as t,b1 as U,bc as ae,ak as S,x as b,b8 as X,c3 as te,b5 as M,c4 as le,a as se,c as A,e as y,y as f,bb as oe,bh as re,F as ne,j as ie,a1 as L,k as de,t as j}from"./main-e240daf5.js";import{e as ue,p as me}from"./utils-860c5d06.js";import{r as B,e as pe}from"./validators-753247d6.js";import{_ as Y}from"./RolesSelectBox.vue_vue_type_script_setup_true_lang-39f90ead.js";import{V as fe}from"./VForm-944dec74.js";import{V as O,a as _}from"./VRow-aa2cbdf3.js";import{V as T}from"./VTextField-d1a10f80.js";import{a as ce}from"./formatters-386d1040.js";import{l as ve}from"./lodash-32d68cd8.js";import{V as z}from"./VDivider-93f95dbb.js";import{V as Ve}from"./VDataTableServer-2f4dc5e3.js";import{V as ge}from"./VMenu-949c4526.js";import{V as be,a as E,b as q}from"./VList-4243452f.js";import{V as _e}from"./VPagination-b6aef300.js";import{V as we}from"./VChip-6e0dcd1f.js";import{b as Q}from"./route-block-83d24a4e.js";import"./VInput-6831f60a.js";import"./VSelect-a62939d2.js";import"./VCheckboxBtn-131bf67b.js";import"./VSelectionControl-766cb909.js";import"./useRolesStore-8af2bad2.js";import"./VField-5897687c.js";import"./VTable-6ef119f2.js";const ye=H({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,default:!1},brand:{},disabledRoles:{type:Boolean},defaultRoles:{}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:N}){const u=I,m=N,c=n(!1),x=n(!1),v=n(!1),V=n(),h=n(""),o=n(""),P=n(""),w=n(),k=n({name:void 0,email:void 0,password:void 0}),$=()=>{M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation(),k.value={name:void 0,email:void 0,password:void 0}})},R=()=>{m("update:isDrawerOpen",!1),p.refreshUser(),M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation()})},r=G(),s=()=>{var i;x.value=!0,(i=V.value)==null||i.validate().then(async({valid:e})=>{if(e){try{const g=await r.addUser({name:h.value,email:o.value,role:[],password:P.value,password_confirmation:P.value,terms:!0});m("userData",g.data),m("update:isDrawerOpen",!1),$()}catch(g){g.response.status===422&&(k.value=g.response.data.errors)}x.value=!1}})},C=i=>{m("update:isDrawerOpen",i)},p=J();return K(()=>u.isDrawerOpen,i=>{u.defaultRoles&&(w.value=u.defaultRoles)}),(i,e)=>{const g=le;return D(),F(te,{width:i.$vuetify.display.smAndDown?"auto":677,"model-value":u.isDrawerOpen,"onUpdate:modelValue":C},{default:l(()=>[a(g,{onClick:R}),a(X,{title:"Create New User",subtitle:"Created user details will receive a privacy audit."},{default:l(()=>[a(W,null,{default:l(()=>[a(t(fe),{ref_key:"refForm",ref:V,modelValue:t(v),"onUpdate:modelValue":e[5]||(e[5]=d=>U(v)?v.value=d:null),onSubmit:ae(s,["prevent"])},{default:l(()=>[a(O,null,{default:l(()=>[a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(h),"onUpdate:modelValue":e[0]||(e[0]=d=>U(h)?h.value=d:null),rules:[t(B)],label:"Full Name","error-messages":t(k).name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>U(o)?o.value=d:null),rules:[t(B),t(pe)],label:"Email","error-messages":t(k).email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=d=>U(P)?P.value=d:null),label:"Password",rules:[t(B)],type:t(c)?"text":"password","append-inner-icon":t(c)?"tabler-eye-off":"tabler-eye","error-messages":t(k).password,"onClick:appendInner":e[3]||(e[3]=d=>c.value=!t(c))},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(Y,{modelValue:t(w),"onUpdate:modelValue":e[4]||(e[4]=d=>U(w)?w.value=d:null),rules:[t(B)]},null,8,["modelValue","rules"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(S,{type:"submit",class:"me-3",loading:t(x),disabled:t(x)},{default:l(()=>[b(" Submit ")]),_:1},8,["loading","disabled"]),a(S,{type:"reset",variant:"tonal",color:"secondary",onClick:R},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}}),Ue={class:"d-flex justify-end flex-wrap gap-4"},Pe={class:"d-flex align-center"},ke={key:1},De={class:"d-flex flex-column"},xe={class:"text-base"},he={class:"text-sm text-medium-emphasis"},$e={class:"d-flex gap-1 py-2 flex-wrap w-100"},Ce={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},Se={class:"text-sm text-disabled mb-0"},Ne=H({__name:"index",setup(I){const N=G(),u=n(""),m=n("all"),c=J(),x=n(1),v=n(0),V=n([]),h=n([]),o=n({page:1,itemsPerPage:10,sortBy:[],groupBy:[],search:void 0}),P=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Roles",key:"role",sortable:!1},{title:"",key:"actions",sortable:!1,width:"70"}],w=ve.debounce(async()=>{var r,s,C;try{const p=await N.fetchUsers({q:u.value,role:m.value,...o.value});V.value=p.data,x.value=((r=p.meta)==null?void 0:r.to)||0,v.value=((s=p.meta)==null?void 0:s.total)||0,o.value.page=((C=p.meta)==null?void 0:C.current_page)||0}catch(p){console.log(p)}},500),k=()=>{w(),c.refreshUser()},$=n(!1),R=r=>{confirm("Are you sure you want to deactivate your account?")&&N.deleteUser(r).then(w)};return K([o,u,m,()=>o.value.itemsPerPage],w),(r,s)=>{const C=ee,p=Z,i=se("RouterLink");return D(),A("section",null,[a(O,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[a(X,{title:r.$t("Users")},{default:l(()=>[a(W,null,{default:l(()=>[a(O,{align:"end",justify:"space-between"},{default:l(()=>[a(_,{cols:"12",sm:"4"},{default:l(()=>[a(Y,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=e=>U(m)?m.value=e:null),"default-roles":t(h),label:r.$t("Select Role"),multiple:!1,clearable:""},null,8,["modelValue","default-roles","label"])]),_:1}),a(_,{cols:"12",sm:"4"},{default:l(()=>[a(C,{label:r.$t("Items Per Page"),"model-value":t(o).itemsPerPage,items:[10,20,50,100],"onUpdate:modelValue":s[1]||(s[1]=e=>t(o).itemsPerPage=parseInt(e,10))},null,8,["label","model-value"])]),_:1})]),_:1}),a(O,null,{default:l(()=>[a(_,{class:"d-flex gap-5"},{default:l(()=>[a(p,{modelValue:t(u),"onUpdate:modelValue":s[2]||(s[2]=e=>U(u)?u.value=e:null),placeholder:r.$t("Search"),density:"compact"},null,8,["modelValue","placeholder"]),y("div",Ue,[a(S,{"prepend-icon":"tabler-plus",onClick:s[3]||(s[3]=e=>$.value=!0)},{default:l(()=>[b(f(r.$t("Add New User")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(z),a(t(Ve),{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":s[6]||(s[6]=e=>t(o).page=e),items:t(V),"items-length":t(v),headers:P.map(e=>({...e,title:r.$t(e.title)})),class:"text-no-wrap","onUpdate:options":s[7]||(s[7]=e=>o.value=e)},{"item.name":l(({item:e})=>[y("div",Pe,[a(oe,{size:"34",variant:e.avatar?void 0:"tonal",class:"me-3",color:e.avatar?void 0:t(ue)(e.role).color},{default:l(()=>[e.avatar?(D(),F(re,{key:0,src:e.avatar},null,8,["src"])):(D(),A("span",ke,f(t(ce)(e.name)),1))]),_:2},1032,["variant","color"]),y("div",De,[y("h6",xe,[a(i,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}},class:"font-weight-medium user-list-name"},{default:l(()=>[b(f(e.name),1)]),_:2},1032,["to"])]),y("span",he,f(e.email),1)])])]),"item.role":l(({item:e})=>[y("div",$e,[(D(!0),A(ne,null,ie(e.role,(g,d)=>(D(),F(we,{key:d,label:"",size:"small",color:"default",density:"comfortable"},{default:l(()=>[b(f(g),1)]),_:2},1024))),128))])]),"item.actions":l(({item:e})=>[a(S,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:l(()=>[a(L,{size:"24",icon:"tabler-dots-vertical"}),a(ge,{activator:"parent"},{default:l(()=>[a(be,null,{default:l(()=>[a(E,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}}},{prepend:l(()=>[a(L,{icon:"tabler-eye"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("View")),1)]),_:1})]),_:2},1032,["to"]),t(c).user.id!==e.id&&r.$can("delete","User")?(D(),F(E,{key:0,onClick:g=>R(e.id)},{prepend:l(()=>[a(L,{icon:"tabler-trash"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("Delete")),1)]),_:1})]),_:2},1032,["onClick"])):de("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[a(z),y("div",Ce,[y("p",Se,f(t(me)(t(o),t(v))),1),a(_e,{"model-value":t(o).page,length:Math.ceil(t(v)/t(o).itemsPerPage),"total-visible":r.$vuetify.display.xs?1:Math.ceil(t(v)/t(o).itemsPerPage),"onUpdate:modelValue":s[4]||(s[4]=e=>o.value={...t(o),page:e})},{prev:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Previous")),1)]),_:2},1040)]),next:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Next")),1)]),_:2},1040)]),_:1},8,["model-value","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1},8,["title"]),a(ye,{isDrawerOpen:t($),"onUpdate:isDrawerOpen":s[8]||(s[8]=e=>U($)?$.value=e:null),onUserData:k},null,8,["isDrawerOpen"])]),_:1})]),_:1})])}}});typeof Q=="function"&&Q(Ne);export{Ne as default};
