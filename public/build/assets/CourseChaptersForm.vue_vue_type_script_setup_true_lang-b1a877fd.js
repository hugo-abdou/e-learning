import{_ as H}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-e4bbeb16.js";import{b as J,a as K}from"./GalleryView.vue_vue_type_script_setup_true_lang-27e7cfff.js";import{d as Q,t as b,bY as W,G as U,o as c,i as v,y as e,B as o,e as r,ak as X,F as _,j as O,f as g,w as p,D as Z,aM as V,as as h,E as ee,aT as ae,at as te,au as y,ai as w,m as $,ah as k,dU as le}from"./main-6856e496.js";import{r as oe}from"./validators-f52bbb1d.js";import{u as se}from"./useCourseStore-925d065a.js";import{U as E}from"./utils-3e673e05.js";import{V as ne,a as ie,b as re,c as ue}from"./VExpansionPanel-62a31f2b.js";import{V as de}from"./VCheckbox-de9fcfb8.js";import{V as ce}from"./VTooltip-4a77e37d.js";import{V as me}from"./VTextField-3f8fbc0a.js";import{a as B}from"./VInput-05f64f58.js";import{V as pe}from"./VDivider-42d2cf99.js";import{V as fe}from"./VForm-3c4b92a0.js";const ve={class:"d-flex justify-space-between w-100 pr-5"},_e={class:"text-h4 text-capitalize"},Ve={key:0},he={class:"d-flex flex-column align-center"},ye={class:""},Ce={class:"d-flex flex-column align-center"},be={class:"text-center"},ze=Q({__name:"CourseChaptersForm",props:{chapters:{default:()=>[{title:"",video:null,documents:[],order:0,id:0,is_main:!0}]}},setup(x,{expose:N}){const P=x,m=b(0),l=b(P.chapters),C=b({}),u=W({open:!1,type:""}),F=U(()=>{switch(u.type){case"upload-chapter-video":return{allowedFileTypes:["video/*"],maxNumberOfFiles:1};case"upload-chapter-document":return{allowedFileTypes:["image/*","application/pdf"],maxNumberOfFiles:10};default:return{allowedFileTypes:["*"],maxNumberOfFiles:1}}}),M=()=>{u.open=!1,u.type=null},T=a=>{u.open=!0,u.type=a},z=a=>{u.type==="upload-chapter-video"&&(l.value[m.value].video=a[0]),u.type==="upload-chapter-document"&&l.value[m.value].documents.push(...a),M()},A=se(),j=async a=>{const t=l.value[a];t.id&&await A.deleteChapter(t.id),l.value=l.value.filter((i,f)=>f!==a)},R=a=>{l.value=l.value.map((t,i)=>({...t,is_main:i===a}))},D=()=>new Promise(async(a,t)=>{for(let i=0;i<l.value.length;i++)if(!l.value[i].title){m.value=i,await le(100);const{valid:f}=await C.value.validate();f||t(new Error("validation faild"))}a("Ok")}),S=async()=>{try{await D(),l.value.push({title:"",video:null,documents:[],order:l.value.length,id:0,is_main:!1}),m.value++}catch{}},L=a=>{const t=[...l.value];t[a]=l.value[a-1],t[a-1]=l.value[a],l.value=t},q=a=>{const t=[...l.value];t[a]=l.value[a+1],t[a+1]=l.value[a],l.value=t},G=U(()=>l.value.length>1);return N({formEl:C,validate:async()=>{try{return await D(),Promise.resolve(l.value)}catch(a){throw a}}}),(a,t)=>{const i=J,f=K,I=H;return c(),v(_,null,[e(fe,{ref_key:"formEl",ref:C},{default:o(()=>[e(ne,{modelValue:r(m),"onUpdate:modelValue":t[3]||(t[3]=s=>X(m)?m.value=s:null),variant:"accordion"},{default:o(()=>[(c(!0),v(_,null,O(r(l),(s,d)=>(c(),g(ie,{key:d},{default:o(()=>[e(re,null,{default:o(()=>[p("div",ve,[p("span",_e,Z(s.title||`Chapter ${d+1}`),1),p("div",{onClick:t[0]||(t[0]=V(()=>{},["stop"])),class:"d-flex justify-center align-center"},[e(de,{"model-value":s.is_main,"onUpdate:modelValue":n=>R(d),"true-icon":"ooui:image-layout-thumbnail","false-icon":"ooui:image-layout-thumbnail"},{default:o(()=>[e(ce,{"open-on-focus":"","max-width":"200",location:"start",activator:"parent"},{default:o(()=>[h(" Click to make this chapter as the main chapter for your course ")]),_:1})]),_:2},1032,["model-value","onUpdate:modelValue"]),r(G)?(c(),v(_,{key:0},[e(i,{disabled:d===0,onClick:V(n=>L(d),["stop"]),icon:"mdi-arrow-up",variant:"text"},null,8,["disabled","onClick"]),e(i,{disabled:d+1>=x.chapters.length,onClick:V(n=>q(d),["stop"]),icon:"mdi-arrow-down",variant:"text"},null,8,["disabled","onClick"])],64)):ee("",!0),e(i,{onClick:V(n=>j(d),["stop"]),icon:"tabler-trash",color:"error",class:"ml-2"},null,8,["onClick"])])])]),_:2},1024),e(ue,{class:"border-t"},{default:o(()=>[e(ae,{class:"mb-5"},{default:o(()=>[e(te,{class:"gap-5"},{default:o(()=>[e(y,{cols:"12"},{default:o(()=>[e(me,{rules:[r(oe)],modelValue:s.title,"onUpdate:modelValue":n=>s.title=n,label:"Chapter Title"},null,8,["rules","modelValue","onUpdate:modelValue"])]),_:2},1024),e(y,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[s.video?(c(),v("div",Ve,[e(f,{media:s.video,hasTitle:"",deletable:"",onOnDelete:n=>s.video=null},null,8,["media","onOnDelete"])])):(c(),g(w,$({key:1,onClick:t[1]||(t[1]=n=>T("upload-chapter-video"))},r(E)),{default:o(()=>[p("div",he,[e(k,{icon:"fluent:video-add-20-regular",size:"32"}),e(B,{class:"mt-2"},{default:o(()=>[h("Video")]),_:1})])]),_:1},16))]),_:2},1024),e(pe,{vertical:"",class:"my-5"}),(c(!0),v(_,null,O(s.documents,n=>(c(),g(y,{cols:"12",sm:"6",md:"4",lg:"3",key:n.id,class:""},{default:o(()=>[p("div",ye,[e(f,{media:n,hasTitle:"",deletable:"",onOnDelete:we=>s.documents=s.documents.filter(({id:Y})=>Y!==n.id)},null,8,["media","onOnDelete"])])]),_:2},1024))),128)),e(y,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[e(w,$(r(E),{onClick:t[2]||(t[2]=n=>T("upload-chapter-document"))}),{default:o(()=>[p("div",Ce,[e(k,{icon:"fluent:document-add-16-regular",size:"32"}),e(B,{class:"mt-2"},{default:o(()=>[h("Documents")]),_:1})])]),_:1},16)]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512),p("div",be,[e(w,{onClick:S,class:"mt-5",variant:"tonal",rounded:"pill"},{default:o(()=>[e(k,{start:"",icon:"tabler-plus",size:"22"}),h(" Add Chapter ")]),_:1})]),e(I,{"allowed-file-types":r(F).allowedFileTypes,"max-number-of-files":r(F).maxNumberOfFiles,onDone:z,"is-dialog-visible":r(u).open,"onUpdate:isDialogVisible":t[4]||(t[4]=s=>r(u).open=s)},null,8,["allowed-file-types","max-number-of-files","is-dialog-visible"])],64)}}});export{ze as _};
