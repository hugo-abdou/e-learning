import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-d0874295.js";import{_ as Z}from"./AppSelect.vue_vue_type_script_setup_true_lang-c9bff932.js";import{u as Q}from"./useUserListStore-48831b87.js";import{d as G,r as n,N as H,w as J,o as k,h as B,f as l,b as a,bh as K,q as t,b4 as U,bf as ee,am as S,y as b,bb as W,cf as ae,b8 as M,cg as te,a as le,c as L,e as y,z as f,be as se,f2 as oe,bm as re,F as ne,j as ie,a4 as A,k as de,c2 as ue,bF as me,v as j,aU as pe}from"./main-de81c04a.js";import{r as F,e as fe}from"./validators-3b3891f3.js";import{_ as X}from"./RolesSelectBox.vue_vue_type_script_setup_true_lang-2ae53875.js";import{V as ce}from"./VForm-5850c8d7.js";import{V as O,a as _}from"./VRow-712fdf8b.js";import{V as T}from"./VTextField-687a8006.js";import{a as ve}from"./formatters-386d1040.js";import{l as Ve}from"./lodash-5f4e712f.js";import{V as z}from"./VDivider-faf1c2d7.js";import{V as ge}from"./VDataTableServer-d395b513.js";import{V as be}from"./VMenu-e0abccb1.js";import{V as _e,a as E,b as q}from"./VList-2584110e.js";import"./VInput-b77c619e.js";import"./VSelect-d4ff51fd.js";import"./VCheckboxBtn-a8607aa9.js";import"./VSelectionControl-18614d5a.js";import"./useRolesStore-303c65ee.js";import"./VField-cd3a8674.js";import"./VTable-69e75c36.js";import"./ssrBoot-7790c7e6.js";const we=G({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,default:!1},brand:{},disabledRoles:{type:Boolean},defaultRoles:{}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:N}){const u=I,m=N,c=n(!1),x=n(!1),v=n(!1),V=n(),h=n(""),o=n(""),P=n(""),w=n(),D=n({name:void 0,email:void 0,password:void 0}),$=()=>{M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation(),D.value={name:void 0,email:void 0,password:void 0}})},R=()=>{m("update:isDrawerOpen",!1),p.refreshUser(),M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation()})},r=Q(),s=()=>{var i;x.value=!0,(i=V.value)==null||i.validate().then(async({valid:e})=>{if(e){try{const g=await r.addUser({name:h.value,email:o.value,role:[],password:P.value,password_confirmation:P.value,terms:!0});m("userData",g.data),m("update:isDrawerOpen",!1),$()}catch(g){g.response.status===422&&(D.value=g.response.data.errors)}x.value=!1}})},C=i=>{m("update:isDrawerOpen",i)},p=H();return J(()=>u.isDrawerOpen,i=>{u.defaultRoles&&(w.value=u.defaultRoles)}),(i,e)=>{const g=te;return k(),B(ae,{width:i.$vuetify.display.smAndDown?"auto":677,"model-value":u.isDrawerOpen,"onUpdate:modelValue":C},{default:l(()=>[a(g,{onClick:R}),a(W,{title:"Create New User",subtitle:"Created user details will receive a privacy audit."},{default:l(()=>[a(K,null,{default:l(()=>[a(t(ce),{ref_key:"refForm",ref:V,modelValue:t(v),"onUpdate:modelValue":e[5]||(e[5]=d=>U(v)?v.value=d:null),onSubmit:ee(s,["prevent"])},{default:l(()=>[a(O,null,{default:l(()=>[a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(h),"onUpdate:modelValue":e[0]||(e[0]=d=>U(h)?h.value=d:null),rules:[t(F)],label:"Full Name","error-messages":t(D).name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>U(o)?o.value=d:null),rules:[t(F),t(fe)],label:"Email","error-messages":t(D).email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=d=>U(P)?P.value=d:null),label:"Password",rules:[t(F)],type:t(c)?"text":"password","append-inner-icon":t(c)?"tabler-eye-off":"tabler-eye","error-messages":t(D).password,"onClick:appendInner":e[3]||(e[3]=d=>c.value=!t(c))},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1}),a(_,{cols:"12",md:"6"},{default:l(()=>[a(X,{modelValue:t(w),"onUpdate:modelValue":e[4]||(e[4]=d=>U(w)?w.value=d:null),rules:[t(F)]},null,8,["modelValue","rules"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(S,{type:"submit",class:"me-3",loading:t(x),disabled:t(x)},{default:l(()=>[b(" Submit ")]),_:1},8,["loading","disabled"]),a(S,{type:"reset",variant:"tonal",color:"secondary",onClick:R},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}}),ye={class:"d-flex justify-end flex-wrap gap-4"},Ue={class:"d-flex align-center"},Pe={key:1},De={class:"d-flex flex-column"},ke={class:"text-base"},xe={class:"text-sm text-medium-emphasis"},he={class:"d-flex gap-1 py-2 flex-wrap w-100"},$e={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-disabled mb-0"},Ze=G({__name:"index",setup(I){const N=Q(),u=n(""),m=n("all"),c=H(),x=n(1),v=n(0),V=n([]),h=n([]),o=n({page:1,itemsPerPage:10,sortBy:[],groupBy:[],search:void 0}),P=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Roles",key:"role",sortable:!1},{title:"",key:"actions",sortable:!1,width:"70"}],w=Ve.debounce(async()=>{var r,s,C;try{const p=await N.fetchUsers({q:u.value,role:m.value,...o.value});V.value=p.data,x.value=((r=p.meta)==null?void 0:r.to)||0,v.value=((s=p.meta)==null?void 0:s.total)||0,o.value.page=((C=p.meta)==null?void 0:C.current_page)||0}catch(p){console.log(p)}},500),D=()=>{w(),c.refreshUser()},$=n(!1),R=r=>{confirm("Are you sure you want to deactivate your account?")&&N.deleteUser(r).then(w)};return J([o,u,m,()=>o.value.itemsPerPage],w),(r,s)=>{const C=Z,p=Y,i=le("RouterLink");return k(),L("section",null,[a(O,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[a(W,{title:r.$t("Users")},{default:l(()=>[a(K,null,{default:l(()=>[a(O,{align:"end",justify:"space-between"},{default:l(()=>[a(_,{cols:"12",sm:"4"},{default:l(()=>[a(X,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=e=>U(m)?m.value=e:null),"default-roles":t(h),label:r.$t("Select Role"),multiple:!1,clearable:""},null,8,["modelValue","default-roles","label"])]),_:1}),a(_,{cols:"12",sm:"4"},{default:l(()=>[a(C,{label:r.$t("Items Per Page"),"model-value":t(o).itemsPerPage,items:[10,20,50,100],"onUpdate:modelValue":s[1]||(s[1]=e=>t(o).itemsPerPage=parseInt(e,10))},null,8,["label","model-value"])]),_:1})]),_:1}),a(O,null,{default:l(()=>[a(_,{class:"d-flex gap-5"},{default:l(()=>[a(p,{modelValue:t(u),"onUpdate:modelValue":s[2]||(s[2]=e=>U(u)?u.value=e:null),placeholder:r.$t("Search"),density:"compact"},null,8,["modelValue","placeholder"]),y("div",ye,[a(S,{"prepend-icon":"tabler-plus",onClick:s[3]||(s[3]=e=>$.value=!0)},{default:l(()=>[b(f(r.$t("New User")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(z),a(t(ge),{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":s[6]||(s[6]=e=>t(o).page=e),items:t(V),"items-length":t(v),headers:P.map(e=>({...e,title:r.$t(e.title)})),class:"text-no-wrap","onUpdate:options":s[7]||(s[7]=e=>o.value=e)},{"item.name":l(({item:e})=>[y("div",Ue,[a(se,{size:"34",variant:e.avatar?void 0:"tonal",class:"me-3",color:e.avatar?void 0:t(oe)(e.role).color},{default:l(()=>[e.avatar?(k(),B(re,{key:0,src:e.avatar},null,8,["src"])):(k(),L("span",Pe,f(t(ve)(e.name)),1))]),_:2},1032,["variant","color"]),y("div",De,[y("h6",ke,[a(i,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}},class:"font-weight-medium user-list-name"},{default:l(()=>[b(f(e.name),1)]),_:2},1032,["to"])]),y("span",xe,f(e.email),1)])])]),"item.role":l(({item:e})=>[y("div",he,[(k(!0),L(ne,null,ie(e.role,(g,d)=>(k(),B(pe,{key:d,label:"",size:"small",color:"default",density:"comfortable"},{default:l(()=>[b(f(g),1)]),_:2},1024))),128))])]),"item.actions":l(({item:e})=>[a(S,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:l(()=>[a(A,{size:"24",icon:"tabler-dots-vertical"}),a(be,{activator:"parent"},{default:l(()=>[a(_e,null,{default:l(()=>[a(E,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}}},{prepend:l(()=>[a(A,{icon:"tabler-eye"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("View")),1)]),_:1})]),_:2},1032,["to"]),t(c).user.id!==e.id&&r.$can("delete","User")?(k(),B(E,{key:0,onClick:g=>R(e.id)},{prepend:l(()=>[a(A,{icon:"tabler-trash"})]),default:l(()=>[a(q,null,{default:l(()=>[b(f(r.$t("Delete")),1)]),_:1})]),_:2},1032,["onClick"])):de("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[a(z),y("div",$e,[y("p",Ce,f(t(ue)(t(o),t(v))),1),a(me,{"model-value":t(o).page,length:Math.ceil(t(v)/t(o).itemsPerPage),"total-visible":r.$vuetify.display.xs?1:Math.ceil(t(v)/t(o).itemsPerPage),"onUpdate:modelValue":s[4]||(s[4]=e=>o.value={...t(o),page:e})},{prev:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Previous")),1)]),_:2},1040)]),next:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[b(f(r.$t("Next")),1)]),_:2},1040)]),_:1},8,["model-value","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1},8,["title"]),a(we,{isDrawerOpen:t($),"onUpdate:isDrawerOpen":s[8]||(s[8]=e=>U($)?$.value=e:null),onUserData:D},null,8,["isDrawerOpen"])]),_:1})]),_:1})])}}});export{Ze as default};
