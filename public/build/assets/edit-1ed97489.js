import{_ as P}from"./CourseChaptersForm.vue_vue_type_script_setup_true_lang-de06a9cb.js";import{_ as W}from"./CourseDetailsForm.vue_vue_type_script_setup_true_lang-9533bead.js";import{u as $}from"./useCourseStore-bcb65a48.js";import{d as q,e7 as z,d3 as G,s as J,t as d,a9 as M,o as p,f as v,B as o,y as t,aq as O,ar as h,e as r,ah as y,i as Y,F as H,j as K,E as w,w as x,D as Q,cY as X,af as C,G as k,ap as Z,aV as S}from"./main-0fb5c6c1.js";import{b as ee,c as te,V as ae,a as B}from"./VWindowItem-74ebafaa.js";import{V as oe}from"./VSpacer-a52f38da.js";import{V as re}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-b5be49e2.js";import"./InfoTooltip.vue_vue_type_script_setup_true_lang-5b9b39a6.js";import"./VTooltip-77b464e2.js";import"./ActionButton-8a4a1c1c.js";import"./validators-f52bbb1d.js";import"./index-7381233a.js";import"./VChip-3b2a7de1.js";import"./VPagination-765357c7.js";import"./VMenu-0d165f1d.js";import"./VList-48ccb2a7.js";import"./VDivider-840de6e4.js";import"./VTextField-532f6e97.js";import"./VInput-e0df6d44.js";import"./VSelect-4aaf1ab0.js";import"./VCheckboxBtn-519cbdc3.js";import"./VSwitch-080b758b.js";import"./VForm-9682cdf4.js";import"./AppSelect.vue_vue_type_script_setup_true_lang-2d20289e.js";import"./VSlideGroup-7dea807f.js";import"./AppTextField.vue_vue_type_script_setup_true_lang-2f8d64a7.js";import"./VCheckbox-4c0a37b3.js";import"./lodash-f161a86d.js";const se={class:"d-flex gap-2 justify-space-between mt-8"},le=q({__name:"edit",setup(ie){const g=z(),T=G(),N=J(),V=$(),i=d(0),m=d("list"),f=d([{icon:"tabler-clipboard",title:"Details",subtitle:"Enter Coure Details",discription:"Provide data with this form to create your Coure",component:null},{icon:"grommet-icons:chapter-add",title:"Chapters",subtitle:"Add Chapters",discription:"Add Chapters",component:null}]),l=d(),_=d([]);M(async()=>{var n,a,u;try{l.value=await V.getCourse(Number(T.params.id),{additional:{chapters:!0}}),_.value=((n=l.value)==null?void 0:n.chapters)||[],(a=l.value)==null||delete a.chapters,(u=l.value)==null||delete u.author}catch{N.push({name:"course"})}});const D=async()=>{var a,u;const n=f.value[i.value];try{if(n.title.toLocaleLowerCase()==="details"&&l.value){const s=await((a=n.component)==null?void 0:a.validate());V.updateCourse(l.value.id,s)}if(n.title.toLocaleLowerCase()==="chapters"&&l.value){const s=await((u=n.component)==null?void 0:u.validate()),e=l.value.id,F=s.map((c,L)=>{const b={};return c.attachments.forEach(({name:E,id:R,type:U,download:j,visibility:A,watermark:I})=>{b[R]={name:E,type:U,download:j,visibility:JSON.stringify(A),watermark:I}}),{...c,course_id:e,attachments:b,order:L}});g.add({text:"course updated successfuly",timeout:5e3}),await Promise.all(F.map(c=>V.updateChapter(c.id||0,c)))}}catch(s){g.add({text:s==null?void 0:s.message,color:"error",timeout:5e3})}};return(n,a)=>{const u=W,s=P;return p(),v(re,null,{default:o(()=>[t(O,{align:"center"},{default:o(()=>[t(h,{class:"d-flex gap-2 flex-wrap",style:{"flex-grow":"12 !important"}},{default:o(()=>[t(ee,{modelValue:r(i),"onUpdate:modelValue":a[0]||(a[0]=e=>y(i)?i.value=e:null),class:"v-tabs-pill"},{default:o(()=>[(p(!0),Y(H,null,K(r(f),e=>(p(),v(te,{key:e.icon},{default:o(()=>[t(w,{size:18,icon:e.icon,class:"me-1"},null,8,["icon"]),x("span",null,Q(e.title),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),r(i)===1?(p(),v(h,{key:0},{default:o(()=>[t(X,{modelValue:r(m),"onUpdate:modelValue":a[1]||(a[1]=e=>y(m)?m.value=e:null),divided:"",color:"primary",variant:"outlined",class:"mx-auto"},{default:o(()=>[t(C,{value:"list",icon:"mdi-list-box-outline"}),t(C,{value:"grid",icon:"mdi-grid-large"})]),_:1},8,["modelValue"])]),_:1})):k("",!0),t(h,{cols:"12"},{default:o(()=>[t(ae,{modelValue:r(i),"onUpdate:modelValue":a[2]||(a[2]=e=>y(i)?i.value=e:null),class:"mt-5 overflow-visible"},{default:o(()=>[t(B,null,{default:o(()=>[t(u,{course:r(l),ref:e=>r(f)[0].component=e},null,8,["course"])]),_:1}),t(B,null,{default:o(()=>[r(_)?(p(),v(s,{key:0,gridType:r(m),chapters:r(_),ref:e=>r(f)[1].component=e},null,8,["gridType","chapters"])):k("",!0)]),_:1})]),_:1},8,["modelValue"]),x("div",se,[t(oe),t(C,{color:"success",onClick:D},{default:o(()=>[Z(" Save "),t(w,{icon:"tabler-check",end:"",class:"flip-in-rtl"})]),_:1})])]),_:1})]),_:1})]),_:1})}}});typeof S=="function"&&S(le);export{le as default};
