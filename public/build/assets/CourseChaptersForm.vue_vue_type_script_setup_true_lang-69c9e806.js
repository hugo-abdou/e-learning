import{_ as R}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-98dad605.js";import{b as I,a as L}from"./GalleryView.vue_vue_type_script_setup_true_lang-f9c262fc.js";import{d as q,t as w,c0 as G,G as K,I as X,o as p,i as v,y as l,B as o,e as u,ak as H,F as _,j as x,f as F,w as f,aK as J,as as y,D as Q,aM as h,E as W,aX as Y,at as Z,au as C,ai as T,m as ee,ah as D,dS as ae}from"./main-d3200a92.js";import{r as te}from"./validators-f52bbb1d.js";import{u as le}from"./useCourseStore-3c100176.js";import{U as oe}from"./utils-c92527c4.js";import{V as se,a as ne,b as re,c as ie}from"./VExpansionPanel-9d02d201.js";import{V as ue}from"./VTextField-ff3454b2.js";import{a as de}from"./VInput-a4774bed.js";import{V as ce}from"./VForm-a28d883b.js";const pe={class:"d-flex justify-space-between w-100 pr-5"},me={class:""},fe={class:"d-flex flex-column align-center"},ve={class:"text-center"},De=q({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]}},setup(g,{expose:E}){const B=g,U=le(),d=w(0),a=w(B.chapters),V=w({}),n=G({open:!1,type:""}),b=K(()=>{switch(n.type){case"upload-chapter-document":return{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3};default:return{allowedFileTypes:["*"],maxNumberOfFiles:1}}});X(()=>{a.value.length===0&&a.value.push({title:"",video:null,attachments:[],order:0,id:0})});const N=()=>{n.open=!1,n.type=null},P=e=>{n.open=!0,n.type=e},$=e=>{n.type==="upload-chapter-video"&&(a.value[d.value].video=e[0]),n.type==="upload-chapter-document"&&a.value[d.value].attachments.push(...e),N()},O=async e=>{const t=a.value[e];t.id&&await U.deleteChapter(t.id),a.value=a.value.filter((r,m)=>m!==e)},k=()=>new Promise(async(e,t)=>{for(let r=0;r<a.value.length;r++)if(!a.value[r].title){d.value=r,await ae(100);const{valid:m}=await V.value.validate();m||t(new Error("validation faild"))}e("Ok")}),M=async()=>{try{await k(),a.value.push({title:"",video:null,attachments:[],order:a.value.length,id:0}),d.value++}catch{}},S=e=>{const t=[...a.value];t[e]=a.value[e-1],t[e-1]=a.value[e],a.value=t},j=e=>{const t=[...a.value];t[e]=a.value[e+1],t[e+1]=a.value[e],a.value=t};return E({formEl:V,validate:async()=>{try{return await k(),Promise.resolve(a.value)}catch(e){throw e}}}),(e,t)=>{const r=I,m=L,z=R;return p(),v(_,null,[l(ce,{ref_key:"formEl",ref:V},{default:o(()=>[l(se,{modelValue:u(d),"onUpdate:modelValue":t[2]||(t[2]=s=>H(d)?d.value=s:null),variant:"accordion"},{default:o(()=>[(p(!0),v(_,null,x(u(a),(s,c)=>(p(),F(ne,{key:c},{default:o(()=>[l(re,null,{default:o(()=>[f("div",pe,[l(J,{class:"text-capitalize"},{default:o(()=>[y(Q(s.title||`Chapter ${c+1}`),1)]),_:2},1024),f("div",{onClick:t[0]||(t[0]=h(()=>{},["stop"])),class:"d-flex justify-center align-center"},[u(a).length>1?(p(),v(_,{key:0},[l(r,{disabled:c===0,onClick:h(i=>S(c),["stop"]),icon:"mdi-arrow-up",variant:"text"},null,8,["disabled","onClick"]),l(r,{disabled:c+1>=g.chapters.length,onClick:h(i=>j(c),["stop"]),icon:"mdi-arrow-down",variant:"text"},null,8,["disabled","onClick"]),l(r,{onClick:h(i=>O(c),["stop"]),icon:"tabler-trash",color:"error",class:"ml-2"},null,8,["onClick"])],64)):W("",!0)])])]),_:2},1024),l(ie,{class:"border-t"},{default:o(()=>[l(Y,{class:"mb-5"},{default:o(()=>[l(Z,null,{default:o(()=>[l(C,{cols:"12"},{default:o(()=>[l(ue,{rules:[u(te)],modelValue:s.title,"onUpdate:modelValue":i=>s.title=i,label:"Chapter Title"},null,8,["rules","modelValue","onUpdate:modelValue"])]),_:2},1024),(p(!0),v(_,null,x(s.attachments,i=>(p(),F(C,{cols:"12",sm:"6",md:"4",lg:"3",key:i.id,class:""},{default:o(()=>[f("div",me,[l(m,{media:i,hasTitle:"",deletable:"",onOnDelete:he=>s.attachments=s.attachments.filter(({id:A})=>A!==i.id)},null,8,["media","onOnDelete"])])]),_:2},1024))),128)),l(C,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[l(T,ee(u(oe),{onClick:t[1]||(t[1]=i=>P("upload-chapter-document"))}),{default:o(()=>[f("div",fe,[l(D,{icon:"fluent:document-add-16-regular",size:"32"}),l(de,{class:"mt-2"},{default:o(()=>[y("attachments")]),_:1})])]),_:1},16)]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512),f("div",ve,[l(T,{onClick:M,class:"mt-5",variant:"tonal",rounded:"pill"},{default:o(()=>[l(D,{start:"",icon:"tabler-plus",size:"22"}),y(" Add Chapter ")]),_:1})]),l(z,{"allowed-file-types":u(b).allowedFileTypes,"max-number-of-files":u(b).maxNumberOfFiles,onDone:$,"is-dialog-visible":u(n).open,"onUpdate:isDialogVisible":t[3]||(t[3]=s=>u(n).open=s)},null,8,["allowed-file-types","max-number-of-files","is-dialog-visible"])],64)}}});export{De as _};
