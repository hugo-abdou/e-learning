import{_ as J,a as K}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-73b71da1.js";import{_ as W}from"./AppSelect.vue_vue_type_script_setup_true_lang-b3c9fd04.js";import{_ as X}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-7165c29f.js";import{_ as Y}from"./ActionButton-4878606a.js";import{d as ee,r as V,ci as ae,a9 as le,I as te,o as b,c as U,b as a,f as l,q as i,b4 as oe,A as se,F,j as ie,e as f,y as T,z as _,am as P,h as S,bZ as ne,bd as re,V as de,v as D,bf as w,bh as v,bb as ue,c8 as pe,k as me,cj as ce,a4 as fe,ck as ve,cl as Ve}from"./main-83f81ad7.js";import{r as y}from"./validators-4b12fd35.js";import{u as be}from"./useCourseStore-c17730ae.js";import{u as he}from"./useQuizzesStore-03bccf3d.js";import{V as _e,a as we,b as ye,c as ge}from"./VExpansionPanel-3f03541e.js";import{V as ke}from"./VForm-ee00a18c.js";import{V as Ce}from"./VMenu-2063156d.js";import{V as ze}from"./VList-26f98dda.js";import{V as xe,a as g}from"./VRow-4a6d7b26.js";import{V as k}from"./VTextField-d890cb14.js";import{V as $e}from"./VDivider-1b4c54ac.js";import{V as Ue}from"./VSelect-241a8653.js";import{V as Fe}from"./VSwitch-b5fa853e.js";import{b as q}from"./VInput-c65df7da.js";const Te={class:"text-truncate"},Pe={class:"d-flex justify-space-between align-center flex-wrap flex-md-nowrap flex-column flex-md-row"},Se={class:"v-col-md-4 pa-0 pa-md-2 h-100"},De={class:"v-col-md-8"},qe={class:"d-flex flex-column align-center"},Be={class:"text-center"},aa=ee({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"list"}},setup(B,{expose:E}){const C=B,N=be(),m=V(0),t=V(C.chapters),z=V([]),h=V({}),u=ae({open:!1,type:""}),x=le(()=>{var e;return((e=t.value[m.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}}),A=he();te(()=>{console.log(C.chapters),t.value.length===0&&t.value.push({title:"",attachments:[],quizzes:[],order:0,id:0}),A.getQuizzes({params:{itemsPerPage:1e3}}).then(({data:e})=>z.value=e)});const M=()=>{u.open=!1,u.type=null},O=e=>{u.open=!0,u.type=e},j=e=>{u.type==="upload-chapter-attachment"&&t.value[m.value].attachments.push(...e.map((s,r)=>({...s,visibility:[],download:!1,watermark:""}))),M()},Q=async e=>{const s=t.value[e];s.id&&await N.deleteChapter(s.id),t.value=t.value.filter((r,p)=>p!==e)},$=()=>new Promise(async(e,s)=>{for(let r=0;r<t.value.length;r++){m.value=r,await ve(100);const{valid:p}=await h.value.validate();if(!p)return Ve(),s(new Error("validation faild"))}e("Ok")}),I=async()=>{try{await $(),t.value.push({title:"",attachments:[],quizzes:[],order:t.value.length,id:0}),m.value++}catch{}},L=e=>{const s=[...t.value];s[e]=t.value[e-1],s[e-1]=t.value[e],t.value=s},R=e=>{const s=[...t.value];s[e]=t.value[e+1],s[e+1]=t.value[e],t.value=s};return E({formEl:h,validate:async()=>{try{return await $(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,s)=>{const r=Y,p=X,Z=K,G=W,H=J;return b(),U(F,null,[a(i(ke),{ref_key:"formEl",ref:h},{default:l(()=>[a(_e,{modelValue:i(m),"onUpdate:modelValue":s[1]||(s[1]=n=>oe(m)?m.value=n:null),class:se(i(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(b(!0),U(F,null,ie(i(t),(n,c)=>(b(),S(we,{key:c},{default:l(()=>[a(ye,null,ne({default:l(()=>[a(re,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[f("span",Te,_(n.title||`Chapter ${c+1}`),1),a(de)]),_:2},1024)]),_:2},[i(t).length>1?{name:"actions",fn:l(()=>[a(Ce,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:o})=>[a(r,D({variant:"plain",color:"default"},o,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(ze,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(r,{variant:"text",disabled:c===0,icon:"mdi-arrow-up",onClick:w(o=>L(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",disabled:c+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:w(o=>R(c),["stop"])},null,8,["disabled","onClick"]),a(r,{variant:"text",icon:"tabler-trash",color:"error",onClick:w(o=>Q(c),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(ge,{class:"border-t"},{default:l(()=>[a(v,{class:"mb-5"},{default:l(()=>[a(xe,null,{default:l(()=>[a(g,{cols:"12",class:"mb-2"},{default:l(()=>[a(k,{modelValue:n.title,"onUpdate:modelValue":o=>n.title=o,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(Z,{class:"w-100",items:n.attachments,grid:{cols:"12"}},{default:l(({item:o})=>[a(ue,{class:"bg-background"},{default:l(()=>[f("div",Pe,[f("div",Se,[a(i(pe),{media:o,preview:"",deletable:"",onDelete:()=>{n.attachments=n.attachments.filter(({id:d})=>d!==o.id)}},null,8,["media","onDelete"])]),a($e,{vertical:e.$vuetify.display.mdAndUp},null,8,["vertical"]),f("div",De,[a(v,null,{default:l(()=>[a(k,{modelValue:o.name,"onUpdate:modelValue":d=>o.name=d,rules:[i(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(v,null,{default:l(()=>[a(Ue,{modelValue:o.visibility,"onUpdate:modelValue":d=>o.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[i(y)],chips:"",multiple:""},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(v,{class:"d-flex justify-space-between"},{default:l(()=>[a(Fe,{modelValue:o.download,"onUpdate:modelValue":d=>o.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(p,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),o.type==="pdf"?(b(),S(v,{key:0},{default:l(()=>[a(k,{modelValue:o.watermark,"onUpdate:modelValue":d=>o.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):me("",!0)])])]),_:2},1024)]),_:2},1032,["items"]),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(q,{text:e.$t("chapter.fields.attachments.label")},null,8,["text"]),a(p,{text:"upload the course materials that you prepare for this chapter"},{default:l(({props:o})=>[a(P,D({...o,...i(ce)},{style:{"block-size":"100%"},onClick:s[0]||(s[0]=d=>O("upload-chapter-attachment"))}),{default:l(()=>[f("div",qe,[a(fe,{icon:"fluent:document-add-16-regular",size:"32"}),a(q,{class:"mt-2"},{default:l(()=>[T(_(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1})]),_:1}),a(g,{cols:"12",class:"mb-4"},{default:l(()=>[a(G,{modelValue:n.quizzes,"onUpdate:modelValue":o=>n.quizzes=o,items:i(z),label:"Quizzes","item-value":"id",placeholder:"Select Quizzes",chips:"",multiple:"","closable-chips":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),f("div",Be,[a(P,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:I},{default:l(()=>[T(_(e.$t("Add Chapter")),1)]),_:1})]),a(H,{"is-dialog-visible":i(u).open,"onUpdate:isDialogVisible":s[2]||(s[2]=n=>i(u).open=n),"allowed-file-types":i(x).allowedFileTypes,"max-number-of-files":i(x).maxNumberOfFiles,onDone:j},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{aa as _};
