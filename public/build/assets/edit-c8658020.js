import{_ as z}from"./CourseChaptersForm.vue_vue_type_script_setup_true_lang-64bd3ec8.js";import{_ as A}from"./CourseDetailsForm.vue_vue_type_script_setup_true_lang-b4a6793b.js";import{d as I,b$ as P,k as J,l as M,r as m,bW as O,o as p,h as v,f as a,b as t,p as r,b0 as h,c as q,j as G,F as H,c0 as K,aj as b,z as w,e as x,v as Q,a0 as k,x as X}from"./main-646bca11.js";import{u as Y}from"./useCourseStore-0bdb64fb.js";import{a as C,V as Z}from"./VRow-69ddc25d.js";import{V as ee,a as te,b as S,c as oe}from"./VWindowItem-aa1e1ab4.js";import{V as ae}from"./VSpacer-856cb2a1.js";import{V as re}from"./VContainer-f188e067.js";import{b as B}from"./route-block-83d24a4e.js";import"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-bd920a7d.js";import"./VCheckboxBtn-82324b36.js";import"./VSelectionControl-83d746b1.js";import"./VInput-a5ba3583.js";import"./AppTextField.vue_vue_type_script_setup_true_lang-2c6d0a0d.js";import"./VTextField-9e45d1c7.js";import"./VField-da7d4c45.js";import"./index-bb229566.js";import"./ActionButton-6c2b7794.js";import"./utils-347b8450.js";import"./VChip-ef079901.js";import"./VPagination-56567f85.js";import"./VMenu-29dadc6a.js";import"./VList-b600d46e.js";import"./VDivider-14411822.js";import"./lodash-b6827778.js";import"./preact.module-7f17e2b0.js";import"./InfoTooltip.vue_vue_type_script_setup_true_lang-908c3ffc.js";import"./VTooltip-5494c95b.js";import"./validators-753247d6.js";import"./VExpansionPanel-cd22af4a.js";import"./VForm-5bf088f5.js";import"./VSelect-90b18907.js";import"./VSwitch-e4fb2f46.js";import"./AppSelect.vue_vue_type_script_setup_true_lang-712b0f03.js";import"./VTextarea-ee89b7d1.js";import"./VSlideGroup-1cc90e6c.js";const se={class:"d-flex gap-2 justify-space-between mt-8"},le=I({__name:"edit",setup(ie){const y=P(),N=J(),F=M(),V=Y(),i=m(0),d=m("list"),f=m([{icon:"tabler-clipboard",title:"Details",subtitle:"Enter Coure Details",discription:"Provide data with this form to create your Coure",component:null},{icon:"grommet-icons:chapter-add",title:"Chapters",subtitle:"Add Chapters",discription:"Add Chapters",component:null}]),l=m(),_=m([]);O(async()=>{var n,o,u;try{l.value=await V.getCourse(Number((n=N.params)==null?void 0:n.id),{additional:{chapters:!0}}),_.value=((o=l.value)==null?void 0:o.chapters)||[],delete l.value.chapters,(u=l.value)==null||delete u.author}catch{F.push({name:"course"})}});const L=async()=>{var o,u;const n=f.value[i.value];try{if(n.title.toLocaleLowerCase()==="details"&&l.value){const s=await((o=n.component)==null?void 0:o.validate());V.updateCourse(l.value.id,s)}if(n.title.toLocaleLowerCase()==="chapters"&&l.value){const s=await((u=n.component)==null?void 0:u.validate()),e=l.value.id,T=s.map((c,D)=>{const g={};return c.attachments.forEach(({name:R,id:j,type:E,download:U,visibility:W,watermark:$})=>{g[j]={name:R,type:E,download:U,visibility:JSON.stringify(W),watermark:$}}),{...c,course_id:e,attachments:g,order:D}});y.add({text:"course updated successfuly",timeout:5e3}),await Promise.all(T.map(c=>V.updateChapter(c.id||0,c)))}}catch(s){y.add({text:s==null?void 0:s.message,color:"error",timeout:5e3})}};return(n,o)=>{const u=A,s=z;return p(),v(re,null,{default:a(()=>[t(Z,{align:"center"},{default:a(()=>[t(C,{class:"d-flex gap-2 flex-wrap",style:{"flex-grow":"12 !important"}},{default:a(()=>[t(ee,{modelValue:r(i),"onUpdate:modelValue":o[0]||(o[0]=e=>h(i)?i.value=e:null),class:"v-tabs-pill"},{default:a(()=>[(p(!0),q(H,null,G(r(f),e=>(p(),v(oe,{key:e.icon},{default:a(()=>[t(k,{size:18,icon:e.icon,class:"me-1"},null,8,["icon"]),x("span",null,X(e.title),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),r(i)===1?(p(),v(C,{key:0},{default:a(()=>[t(K,{modelValue:r(d),"onUpdate:modelValue":o[1]||(o[1]=e=>h(d)?d.value=e:null),divided:"",color:"primary",variant:"outlined",class:"mx-auto"},{default:a(()=>[t(b,{value:"list",icon:"mdi-list-box-outline"}),t(b,{value:"grid",icon:"mdi-grid-large"})]),_:1},8,["modelValue"])]),_:1})):w("",!0),t(C,{cols:"12"},{default:a(()=>[t(te,{modelValue:r(i),"onUpdate:modelValue":o[2]||(o[2]=e=>h(i)?i.value=e:null),class:"mt-5 overflow-visible"},{default:a(()=>[t(S,null,{default:a(()=>[t(u,{ref:e=>r(f)[0].component=e,course:r(l)},null,8,["course"])]),_:1}),t(S,null,{default:a(()=>[r(_)?(p(),v(s,{key:0,ref:e=>r(f)[1].component=e,"grid-type":r(d),chapters:r(_)},null,8,["grid-type","chapters"])):w("",!0)]),_:1})]),_:1},8,["modelValue"]),x("div",se,[t(ae),t(b,{color:"success",onClick:L},{default:a(()=>[Q(" Save "),t(k,{icon:"tabler-check",end:"",class:"flip-in-rtl"})]),_:1})])]),_:1})]),_:1})]),_:1})}}});typeof B=="function"&&B(le);export{le as default};
