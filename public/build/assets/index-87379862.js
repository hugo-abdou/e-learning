import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-9838b75e.js";import{_ as Z}from"./AppSelect.vue_vue_type_script_setup_true_lang-ed142275.js";import{u as Q}from"./useUserListStore-651be641.js";import{t as H,r as n,Q as X,w as G,v as x,z as F,A as l,n as a,H as t,L as U,bj as ee,B as S,aa as _,X as M,S as ae,x as O,D as y,E as f,_ as te,F as le,y as se,C as A,a2 as oe,s as j}from"./plugins-1ca62e54.js";import{d as re,p as ne}from"./utils-4f96d8b5.js";import{_ as ie}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-3d4c07f0.js";import{r as B,e as de}from"./validators-3a378363.js";import{_ as J}from"./RolesSelectBox.vue_vue_type_script_setup_true_lang-2dd32cb5.js";import{V as K}from"./VCardText-f87185bc.js";import{V as ue}from"./VForm-11822a25.js";import{V as L,a as w}from"./VRow-063e83bb.js";import{V as T}from"./VTextField-38237e59.js";import{V as W}from"./VCard-2a55749d.js";import{V as me}from"./VDialog-5c924145.js";import{a as pe}from"./formatters-386d1040.js";import{l as fe}from"./lodash-f6b38868.js";import{V as z}from"./VDivider-e9bd568d.js";import{V as ce}from"./VDataTableServer-eb4d016e.js";import{V as ve}from"./VAvatar-15acdbba.js";import{V as Ve}from"./VMenu-3b09bac4.js";import{V as ge,a as E,b as q}from"./VList-32d892a6.js";import{V as _e}from"./VPagination-03e938d2.js";import{V as we}from"./VChip-412e0c07.js";import"./VInput-0f0d564d.js";import"./index-290985fb.js";import"./VSelect-4231bef2.js";import"./forwardRefs-6ea3df5c.js";import"./dialog-transition-7fd252b6.js";import"./VOverlay-ce640807.js";import"./scopeId-598a8366.js";import"./VCheckboxBtn-bf01db5f.js";import"./VSelectionControl-1b1614f2.js";import"./useRolesStore-d44f829f.js";import"./createSimpleFunctional-4f87dcb7.js";import"./VField-5f020633.js";import"./VCardActions-114e80cb.js";import"./_commonjsHelpers-de833af9.js";import"./VTable-1a36a4c7.js";import"./ssrBoot-6bb28df7.js";const be=H({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean,default:!1},brand:{},disabledRoles:{type:Boolean},defaultRoles:{}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:N}){const u=I,m=N,c=n(!1),k=n(!1),v=n(!1),V=n(),$=n(""),o=n(""),P=n(""),b=n(),D=n({name:void 0,email:void 0,password:void 0}),h=()=>{M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation(),D.value={name:void 0,email:void 0,password:void 0}})},R=()=>{m("update:isDrawerOpen",!1),p.refreshUser(),M(()=>{var i,e;(i=V.value)==null||i.reset(),(e=V.value)==null||e.resetValidation()})},r=Q(),s=()=>{var i;k.value=!0,(i=V.value)==null||i.validate().then(async({valid:e})=>{if(e){try{const g=await r.addUser({name:$.value,email:o.value,role:[],password:P.value,password_confirmation:P.value,terms:!0});m("userData",g.data),m("update:isDrawerOpen",!1),h()}catch(g){g.response.status===422&&(D.value=g.response.data.errors)}k.value=!1}})},C=i=>{m("update:isDrawerOpen",i)},p=X();return G(()=>u.isDrawerOpen,i=>{u.defaultRoles&&(b.value=u.defaultRoles)}),(i,e)=>{const g=ie;return x(),F(me,{width:i.$vuetify.display.smAndDown?"auto":677,"model-value":u.isDrawerOpen,"onUpdate:modelValue":C},{default:l(()=>[a(g,{onClick:R}),a(W,{title:"Create New User",subtitle:"Created user details will receive a privacy audit."},{default:l(()=>[a(K,null,{default:l(()=>[a(t(ue),{ref_key:"refForm",ref:V,modelValue:t(v),"onUpdate:modelValue":e[5]||(e[5]=d=>U(v)?v.value=d:null),onSubmit:ee(s,["prevent"])},{default:l(()=>[a(L,null,{default:l(()=>[a(w,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t($),"onUpdate:modelValue":e[0]||(e[0]=d=>U($)?$.value=d:null),rules:[t(B)],label:"Full Name","error-messages":t(D).name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(w,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>U(o)?o.value=d:null),rules:[t(B),t(de)],label:"Email","error-messages":t(D).email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(w,{cols:"12",md:"6"},{default:l(()=>[a(T,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=d=>U(P)?P.value=d:null),label:"Password",rules:[t(B)],type:t(c)?"text":"password","append-inner-icon":t(c)?"tabler-eye-off":"tabler-eye","error-messages":t(D).password,"onClick:appendInner":e[3]||(e[3]=d=>c.value=!t(c))},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1}),a(w,{cols:"12",md:"6"},{default:l(()=>[a(J,{modelValue:t(b),"onUpdate:modelValue":e[4]||(e[4]=d=>U(b)?b.value=d:null),rules:[t(B)]},null,8,["modelValue","rules"])]),_:1}),a(w,{cols:"12"},{default:l(()=>[a(S,{type:"submit",class:"me-3",loading:t(k),disabled:t(k)},{default:l(()=>[_(" Submit ")]),_:1},8,["loading","disabled"]),a(S,{type:"reset",variant:"tonal",color:"secondary",onClick:R},{default:l(()=>[_(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}}),ye={class:"d-flex justify-end flex-wrap gap-4"},Ue={class:"d-flex align-center"},Pe={key:1},De={class:"d-flex flex-column"},xe={class:"text-base"},ke={class:"text-sm text-medium-emphasis"},$e={class:"d-flex gap-1 py-2 flex-wrap w-100"},he={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},Ce={class:"text-sm text-disabled mb-0"},va=H({__name:"index",setup(I){const N=Q(),u=n(""),m=n("all"),c=X(),k=n(1),v=n(0),V=n([]),$=n([]),o=n({page:1,itemsPerPage:10,sortBy:[],groupBy:[],search:void 0}),P=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Roles",key:"role",sortable:!1},{title:"",key:"actions",sortable:!1,width:"70"}],b=fe.debounce(async()=>{var r,s,C;try{const p=await N.fetchUsers({q:u.value,role:m.value,...o.value});V.value=p.data,k.value=((r=p.meta)==null?void 0:r.to)||0,v.value=((s=p.meta)==null?void 0:s.total)||0,o.value.page=((C=p.meta)==null?void 0:C.current_page)||0}catch(p){console.log(p)}},500),D=()=>{b(),c.refreshUser()},h=n(!1),R=r=>{confirm("Are you sure you want to deactivate your account?")&&N.deleteUser(r).then(b)};return G([o,u,m,()=>o.value.itemsPerPage],b),(r,s)=>{const C=Z,p=Y,i=ae("RouterLink");return x(),O("section",null,[a(L,null,{default:l(()=>[a(w,{cols:"12"},{default:l(()=>[a(W,{title:r.$t("Users")},{default:l(()=>[a(K,null,{default:l(()=>[a(L,{align:"end",justify:"space-between"},{default:l(()=>[a(w,{cols:"12",sm:"4"},{default:l(()=>[a(J,{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=e=>U(m)?m.value=e:null),"default-roles":t($),label:r.$t("Select Role"),multiple:!1,clearable:""},null,8,["modelValue","default-roles","label"])]),_:1}),a(w,{cols:"12",sm:"4"},{default:l(()=>[a(C,{label:r.$t("Items Per Page"),"model-value":t(o).itemsPerPage,items:[10,20,50,100],"onUpdate:modelValue":s[1]||(s[1]=e=>t(o).itemsPerPage=parseInt(e,10))},null,8,["label","model-value"])]),_:1})]),_:1}),a(L,null,{default:l(()=>[a(w,{class:"d-flex gap-5"},{default:l(()=>[a(p,{modelValue:t(u),"onUpdate:modelValue":s[2]||(s[2]=e=>U(u)?u.value=e:null),placeholder:r.$t("Search"),density:"compact"},null,8,["modelValue","placeholder"]),y("div",ye,[a(S,{"prepend-icon":"tabler-plus",onClick:s[3]||(s[3]=e=>h.value=!0)},{default:l(()=>[_(f(r.$t("New User")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(z),a(t(ce),{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":s[6]||(s[6]=e=>t(o).page=e),items:t(V),"items-length":t(v),headers:P.map(e=>({...e,title:r.$t(e.title)})),class:"text-no-wrap","onUpdate:options":s[7]||(s[7]=e=>o.value=e)},{"item.name":l(({item:e})=>[y("div",Ue,[a(ve,{size:"34",variant:e.avatar?void 0:"tonal",class:"me-3",color:e.avatar?void 0:t(re)(e.role).color},{default:l(()=>[e.avatar?(x(),F(te,{key:0,src:e.avatar},null,8,["src"])):(x(),O("span",Pe,f(t(pe)(e.name)),1))]),_:2},1032,["variant","color"]),y("div",De,[y("h6",xe,[a(i,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}},class:"font-weight-medium user-list-name"},{default:l(()=>[_(f(e.name),1)]),_:2},1032,["to"])]),y("span",ke,f(e.email),1)])])]),"item.role":l(({item:e})=>[y("div",$e,[(x(!0),O(le,null,se(e.role,(g,d)=>(x(),F(we,{key:d,label:"",size:"small",color:"default",density:"comfortable"},{default:l(()=>[_(f(g),1)]),_:2},1024))),128))])]),"item.actions":l(({item:e})=>[a(S,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:l(()=>[a(A,{size:"24",icon:"tabler-dots-vertical"}),a(Ve,{activator:"parent"},{default:l(()=>[a(ge,null,{default:l(()=>[a(E,{to:t(c).user.id===e.id?{name:"account-settings-tab",params:{tab:"account"}}:{name:"users-id",params:{id:e.id}}},{prepend:l(()=>[a(A,{icon:"tabler-eye"})]),default:l(()=>[a(q,null,{default:l(()=>[_(f(r.$t("View")),1)]),_:1})]),_:2},1032,["to"]),t(c).user.id!==e.id&&r.$can("delete","User")?(x(),F(E,{key:0,onClick:g=>R(e.id)},{prepend:l(()=>[a(A,{icon:"tabler-trash"})]),default:l(()=>[a(q,null,{default:l(()=>[_(f(r.$t("Delete")),1)]),_:1})]),_:2},1032,["onClick"])):oe("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[a(z),y("div",he,[y("p",Ce,f(t(ne)(t(o),t(v))),1),a(_e,{"model-value":t(o).page,length:Math.ceil(t(v)/t(o).itemsPerPage),"total-visible":r.$vuetify.display.xs?1:Math.ceil(t(v)/t(o).itemsPerPage),"onUpdate:modelValue":s[4]||(s[4]=e=>o.value={...t(o),page:e})},{prev:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[_(f(r.$t("Previous")),1)]),_:2},1040)]),next:l(e=>[a(S,j({variant:"tonal",color:"default"},e,{icon:!1}),{default:l(()=>[_(f(r.$t("Next")),1)]),_:2},1040)]),_:1},8,["model-value","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length","headers"])]),_:1},8,["title"]),a(be,{isDrawerOpen:t(h),"onUpdate:isDrawerOpen":s[8]||(s[8]=e=>U(h)?h.value=e:null),onUserData:D},null,8,["isDrawerOpen"])]),_:1})]),_:1})])}}});export{va as default};
