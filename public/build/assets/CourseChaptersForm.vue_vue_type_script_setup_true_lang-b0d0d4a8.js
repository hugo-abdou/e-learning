import{_ as H,a as J}from"./FileUploaderDialog.vue_vue_type_script_setup_true_lang-1ad539a5.js";import{_ as K}from"./InfoTooltip.vue_vue_type_script_setup_true_lang-5436e5d8.js";import{_ as W}from"./ActionButton-7996e9d4.js";import{d as X,r as b,ci as Y,a9 as ee,I as ae,o as V,c as x,b as a,f as l,q as n,b4 as le,A as te,F as $,j as oe,e as f,y as F,z as _,am as U,h as T,bZ as se,bd as ne,V as ie,v as z,bf as w,bh as v,bb as re,c5 as de,k as ue,cj as pe,a4 as me,ck as ce,cl as fe}from"./main-de81c04a.js";import{r as y}from"./validators-3b3891f3.js";import{u as ve}from"./useCourseStore-458c7fca.js";import{u as be}from"./useQuizzesStore-e152037b.js";import{V as Ve,a as he,b as _e,c as we}from"./VExpansionPanel-b89eeb00.js";import{V as ye}from"./VForm-5850c8d7.js";import{V as ge}from"./VMenu-e0abccb1.js";import{V as ke}from"./VList-2584110e.js";import{V as Ce,a as P}from"./VRow-712fdf8b.js";import{V as g}from"./VTextField-687a8006.js";import{V as xe}from"./VDivider-faf1c2d7.js";import{V as $e}from"./VSelect-d4ff51fd.js";import{V as Fe}from"./VSwitch-b42882ed.js";import{b as D}from"./VInput-b77c619e.js";const Ue={class:"text-truncate"},Te={class:"d-flex justify-space-between align-center flex-wrap flex-md-nowrap flex-column flex-md-row"},ze={class:"v-col-md-4 pa-0 pa-md-2 h-100"},Pe={class:"v-col-md-8"},De={class:"d-flex flex-column align-center"},Se={class:"text-center"},Xe=X({__name:"CourseChaptersForm",props:{chapters:{default:()=>[]},gridType:{default:"list"}},setup(S,{expose:B}){const E=S,N=ve(),m=b(0),t=b(E.chapters),A=b([]),h=b({}),u=Y({open:!1,type:""}),k=ee(()=>{var e;return((e=t.value[m.value])==null?void 0:e.attachments.length)===0?{allowedFileTypes:["video/*"],maxNumberOfFiles:1}:u.type==="upload-chapter-attachment"?{allowedFileTypes:["image/*","application/pdf","video/*"],maxNumberOfFiles:3}:{allowedFileTypes:["*"],maxNumberOfFiles:1}}),M=be();ae(()=>{t.value.length===0&&t.value.push({title:"",attachments:[],order:0,id:0}),M.getQuizzes({params:{itemsPerPage:1e3}}).then(({data:e})=>A.value=e)});const O=()=>{u.open=!1,u.type=null},j=e=>{u.open=!0,u.type=e},q=e=>{u.type==="upload-chapter-attachment"&&t.value[m.value].attachments.push(...e.map((o,i)=>({...o,visibility:[],download:!1,watermark:""}))),O()},I=async e=>{const o=t.value[e];o.id&&await N.deleteChapter(o.id),t.value=t.value.filter((i,p)=>p!==e)},C=()=>new Promise(async(e,o)=>{for(let i=0;i<t.value.length;i++){m.value=i,await ce(100);const{valid:p}=await h.value.validate();if(!p)return fe(),o(new Error("validation faild"))}e("Ok")}),L=async()=>{try{await C(),t.value.push({title:"",attachments:[],order:t.value.length,id:0}),m.value++}catch{}},R=e=>{const o=[...t.value];o[e]=t.value[e-1],o[e-1]=t.value[e],t.value=o},Q=e=>{const o=[...t.value];o[e]=t.value[e+1],o[e+1]=t.value[e],t.value=o};return B({formEl:h,validate:async()=>{try{return await C(),Promise.resolve(t.value)}catch(e){throw e}}}),(e,o)=>{const i=W,p=K,Z=J,G=H;return V(),x($,null,[a(n(ye),{ref_key:"formEl",ref:h},{default:l(()=>[a(Ve,{modelValue:n(m),"onUpdate:modelValue":o[1]||(o[1]=r=>le(m)?m.value=r:null),class:te(n(t).length>1&&"no-icon-rotate"),variant:"default"},{default:l(()=>[(V(!0),x($,null,oe(n(t),(r,c)=>(V(),T(he,{key:c},{default:l(()=>[a(_e,null,se({default:l(()=>[a(ne,{style:{"inline-size":"90%"},class:"text-capitalize d-flex pr-0"},{default:l(()=>[f("span",Ue,_(r.title||`Chapter ${c+1}`),1),a(ie)]),_:2},1024)]),_:2},[n(t).length>1?{name:"actions",fn:l(()=>[a(ge,{transition:"speed-dial-left",location:"left center"},{activator:l(({props:s})=>[a(i,z({variant:"plain",color:"default"},s,{icon:"mdi-dots-vertical"}),null,16)]),default:l(()=>[a(ke,{class:"mr-1 px-2 d-flex gap-1 bg-background"},{default:l(()=>[a(i,{variant:"text",disabled:c===0,icon:"mdi-arrow-up",onClick:w(s=>R(c),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",disabled:c+1>=e.chapters.length,icon:"mdi-arrow-down",onClick:w(s=>Q(c),["stop"])},null,8,["disabled","onClick"]),a(i,{variant:"text",icon:"tabler-trash",color:"error",onClick:w(s=>I(c),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),a(we,{class:"border-t"},{default:l(()=>[a(v,{class:"mb-5"},{default:l(()=>[a(Ce,null,{default:l(()=>[a(P,{cols:"12",class:"mb-2"},{default:l(()=>[a(g,{modelValue:r.title,"onUpdate:modelValue":s=>r.title=s,rules:[n(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(Z,{class:"w-100",items:r.attachments,grid:{cols:"12"}},{default:l(({item:s})=>[a(re,{class:"bg-background"},{default:l(()=>[f("div",Te,[f("div",ze,[a(n(de),{media:s,preview:"",deletable:"",onDelete:()=>{r.attachments=r.attachments.filter(({id:d})=>d!==s.id)}},null,8,["media","onDelete"])]),a(xe,{vertical:e.$vuetify.display.mdAndUp},null,8,["vertical"]),f("div",Pe,[a(v,null,{default:l(()=>[a(g,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,rules:[n(y)],label:e.$t("chapter.fields.title.label")},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),a(v,null,{default:l(()=>[a($e,{modelValue:s.visibility,"onUpdate:modelValue":d=>s.visibility=d,items:["Public","Plan A","Plan B"],label:e.$t("chapter.fields.visibility.label"),rules:[n(y)],chips:"",multiple:""},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.visibility.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),a(v,{class:"d-flex justify-space-between"},{default:l(()=>[a(Fe,{modelValue:s.download,"onUpdate:modelValue":d=>s.download=d,label:e.$t("chapter.fields.download.label")},null,8,["modelValue","onUpdate:modelValue","label"]),a(p,{text:e.$t("chapter.fields.download.description")},null,8,["text"])]),_:2},1024),s.type==="pdf"?(V(),T(v,{key:0},{default:l(()=>[a(g,{modelValue:s.watermark,"onUpdate:modelValue":d=>s.watermark=d,label:e.$t("chapter.fields.watermark.label")},{"append-inner":l(()=>[a(p,{text:e.$t("chapter.fields.watermark.description")},null,8,["text"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)):ue("",!0)])])]),_:2},1024)]),_:2},1032,["items"]),a(P,{cols:"12",class:"mb-4"},{default:l(()=>[a(D,{text:e.$t("chapter.fields.attachments.label")},null,8,["text"]),a(p,{text:"upload the course materials that you prepare for this chapter"},{default:l(({props:s})=>[a(U,z({...s,...n(pe)},{style:{"block-size":"100%"},onClick:o[0]||(o[0]=d=>j("upload-chapter-attachment"))}),{default:l(()=>[f("div",De,[a(me,{icon:"fluent:document-add-16-regular",size:"32"}),a(D,{class:"mt-2"},{default:l(()=>[F(_(e.$t("media.upload.label")),1)]),_:1})])]),_:2},1040)]),_:1})]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","class"])]),_:1},512),f("div",Se,[a(U,{class:"mt-5",variant:"tonal","append-icon":"tabler-plus",rounded:"pill",onClick:L},{default:l(()=>[F(_(e.$t("Add Chapter")),1)]),_:1})]),a(G,{"is-dialog-visible":n(u).open,"onUpdate:isDialogVisible":o[2]||(o[2]=r=>n(u).open=r),"allowed-file-types":n(k).allowedFileTypes,"max-number-of-files":n(k).maxNumberOfFiles,onDone:q},null,8,["is-dialog-visible","allowed-file-types","max-number-of-files"])],64)}}});export{Xe as _};
